function Kit(e){var t=[],a=[];e.forEach(function(e){t.push(e.name),a.push(e.url)}),this.names=t,this.urls=a,this.samples=[],this.samplesCount=e.length,this.samplesLoadCount=0,this.startedLoading=!1,this.isLoaded=!1}function startAudio(){audioContext||(audioContext=new(window.AudioContext||window.webkitAudioContext)),"suspended"===audioContext.state&&audioContext.resume()}function playSample(e,t){var a,s=audioContext.createBufferSource(),o=audioContext.createPanner();try{s.buffer=samples[e]}catch(e){console.log(e)}s.playbackRate.value=pitches[e];var r=audioContext.createGain();r.gain.setValueAtTime(vol,audioContext.currentTime);var i=audioContext.createGain();i.gain.setValueAtTime(vols[e],audioContext.currentTime),s.connect(i),i.connect(o),o.connect(r);var n=null,l=null,c=pans[e],p=c+90;p=180-p,n=Math.sin(c*(Math.PI/180)),l=Math.sin(p*(Math.PI/180)),o.setPosition(n,l,1-Math.abs(n)),o.panningModel="equalpower",convolver.bypass?r.connect(compressor.input):(convolver.wetLevel.value=convolverLevels[impulseIdx],r.connect(convolver.input),convolver.connect(compressor.input)),compressor.connect(audioContext.destination),compressor.connect(recorderNode),a=compressor,0==lowpass.bypass&&(a.connect(lowpass.input),a=lowpass),0==highpass.bypass&&(a.connect(highpass.input),a=highpass),a.connect(audioContext.destination),0==convolver.bypass?r.connect(analyser):a.connect(analyser),analyser.connect(audioContext.destination),a.connect(recorderNode),s.start(t)}function playhead(e){var t=(e+15)%16,a=document.getElementById("led"+e),s=document.getElementById("led"+t);if(a.style.backgroundColor="#202020",a.style.color="#fff",a.style.borderRadius="4px",s.style.backgroundColor="#3f3f3f",s.style.color="#35cac5",e%4==0){var o=(e+4)/4;$(".bar-num").removeClass("bar-sel"),$("#bar"+o).addClass("bar-sel")}}function advanceNote(){var e=60/tempo;rhythmIndex++,rhythmIndex==loopLength&&(rhythmIndex=0),noteTime+=rhythmIndex%2?(.25+MAX_SWING*swingFactor)*e:(.25-MAX_SWING*swingFactor)*e}function visualize(){function e(){drawVisual=requestAnimationFrame(e),analyser.getByteFrequencyData(o),canvasContext.fillStyle=CANVAS_BG,canvasContext.fillRect(0,0,t,a);for(var r,i=t/s*1.5,n=0,l=0;l<s;l++)r=o[l],"red"==eqColor?canvasContext.fillStyle="rgb("+(r+100)+", "+(Math.floor(20*Math.random())+1)+", "+(Math.floor(20*Math.random())+1)+")":"yellow"==eqColor?canvasContext.fillStyle="rgb("+(r+100)+", "+(r+100)+", "+(Math.floor(20*Math.random())+1)+")":"purple"==eqColor?canvasContext.fillStyle="rgb("+(r+100)+", "+(Math.floor(50*Math.random())+1)+", "+(r+100)+")":"green"==eqColor&&(canvasContext.fillStyle="rgb(50, "+(r+100)+", "+(r+100)+")"),canvasContext.fillRect(n,a-r/2,i,r/2),n+=i+1}var t=canvas.width,a=canvas.height;analyser.fftSize=256;var s=analyser.frequencyBinCount,o=new Uint8Array(s);canvasContext.clearRect(0,0,t,a),e()}function stopVisualize(){canvasContext.clearRect(0,0,canvas.width,canvas.height),window.cancelAnimationFrame(drawVisual)}function createPanPanel(){for(var e=0;e<8;e++)$("#pan").append('<div class="pan-levels"><p class="pan-left">L</p><div class="track-pan" id="track-pan-'+e+'"><p class="pan-right">R</p></div><span class="tooltip-pans"></span></div>'),$("#track-pan-"+e).slider({value:0,step:10,min:-90,max:90,orientation:"horizontal",range:"min",animate:!0,start:function(e,t){trackPanStart(e,t)},slide:function(e,t){trackPanSlide(e,t)},stop:function(e,t){trackPanStop(e,t)}}),pans.push(0)}function createSequencer(){$("#sequencer").append('<div class="sample-name-placeholder"/>');for(var e,t,a=0;a<16;a++)a%4==0?(e=++barCount,t=' id="bar'+e+'"'):(e="",t=""),$("#sequencer").append('<div class="bar-num"'+t+">"+e+"</div>");for(var s=0;s<8;s++){$("#sequencer").append('<div class="sample-name"><div id = "sample-name-'+s+'">'+kit.names[s]+"</div></div>");for(var o=0;o<16;o++)$("#sequencer").append('<div class = "step-buttons ui-corner-all" data-track ="'+s+'" data-step="'+o+'"></div>');$("#sequencer").append('<div class="levels"><div class="track-vol" id="track-vol-'+s+'"></div><span class="tooltip-vols"></span><div class="pitch" id ="pitch-'+s+'"></div><span class="tooltip-pitches"></span></div>'),$("#track-vol-"+s).slider({value:1,step:.1,min:0,max:1,orientation:"horizontal",range:"min",animate:!0,start:function(e,t){trackVolStart(e,t)},slide:function(e,t){trackVolSlide(e,t)},stop:function(e,t){trackVolStop(e,t)}}),vols.push(1),$("#pitch-"+s).slider({value:1,step:.1,min:.1,max:2,orientation:"horizontal",range:"min",animate:!0,start:function(e,t){trackPitchStart(e,t)},slide:function(e,t){trackPitchSlide(e,t)},stop:function(e,t){trackPitchStop(e,t)}}),pitches.push(1)}$("#sequencer").append('<div class="sample-name-placeholder"/>');for(var a=0;a<16;a++)$("#sequencer").append('<div class="bar-num" id="led'+a+'">'+(a+1)+"</div>");$("#sequencer").append('<div class="vols-label">Volume</div><div class="pitch-label">Pitch</div>')}function trackPanStart(e,t){var a=$("#"+e.target.id).next();a.fadeIn("fast"),a.css("left",$("#"+e.target.id+" span").position().left).text(Math.abs(t.value/10))}function trackPanSlide(e,t){var a=$("#"+e.target.id).next();pans[e.target.id.split("-")[2]]=t.value,a.css("left",$("#"+e.target.id+" span").position().left).text(Math.abs(t.value/10))}function trackPanStop(e,t){$("#"+e.target.id).next().fadeOut("fast")}function trackVolStart(e,t){var a=$("#"+e.target.id).next();a.fadeIn("fast"),a.css("left",$("#"+e.target.id+" span").position().left).text(10*t.value)}function trackVolSlide(e,t){var a=$("#"+e.target.id).next();vols[e.target.id.split("-")[2]]=t.value,a.css("left",$("#"+e.target.id+" span").position().left).text(10*t.value)}function trackVolStop(e,t){$("#"+e.target.id).next().fadeOut("fast")}function trackPitchStart(e,t){var a=$("#"+e.target.id).next();a.fadeIn("fast"),a.css("left",$("#"+e.target.id+" span").position().left+100).text(10*t.value-10)}function trackPitchSlide(e,t){var a=$("#"+e.target.id).next();pitches[e.target.id.split("-")[1]]=t.value,a.css("left",$("#"+e.target.id+" span").position().left+100).text(10*t.value-10)}function trackPitchStop(e,t){$("#"+e.target.id).next().fadeOut("fast")}function setKit(e){e=parseInt(e),kit=new Kit(kits[$.map(kits,function(e){return e.id}).indexOf(e)].info),kit.load();for(var t=0;t<8;t++)$("#sample-name-"+t).text(kit.names[t]),$(".trk-name-"+t).text(kit.names[t])}function setFilter(e){switch(e=parseInt(e),$("#compressor, #lowpass, #highpass").hide(),e){case 1:$("#compressor").show();break;case 2:$("#lowpass").show();break;case 3:$("#highpass").show()}}function changeKit(e){$("#kits").val(e),$("#kits").selectmenu("refresh"),setKit(e)}function setSliderTooltip(e,t,a){a=a||0;var s=$("#"+t+" span").position().left;return $("."+e).css("left",s+a)}function setButton(e,t){t=t||"";""==t?$(e).button():$(e).button({text:!1,icons:{primary:t}})}function setTooltip(e){e.tooltip({items:"[data-tooltip]",content:function(){return $(this).data("tooltip")},hide:!1,track:!0})}function loadDefaults(){$("#default-master-vol").spinner("value",10*startup.vol),$("#default-tempo").spinner("value",startup.tempo),$("#default-kit").val(startup.kit),$("#default-kit").selectmenu("refresh"),startup.tooltips?($("#default-tooltips").prop("checked",!0),setTooltip($(toolTipStr))):$("#default-tooltips").prop("checked",!1),$("#master-vol").slider("value",startup.vol),vol=startup.vol,setVolIcon(),$("#tempo").spinner("value",startup.tempo),tempo=startup.tempo,changeKit(startup.kit),eqColor=void 0===startup.eqColor?"red":startup.eqColor,void 0===startup.clearDialog&&(startup.clearDialog=!0),void 0===startup.notice&&(startup.notice=!0),$(".eq-color").removeClass("eq-color-sel"),$("#"+eqColor).addClass("eq-color-sel")}function getPreferences(){chrome.storage.sync.get(function(e){$.isEmptyObject(e)||(startup=e,startup.tooltips?setTooltip($(toolTipStr)):$(toolTipStr).tooltip({disabled:!0}),loadDefaults()),startup.notice&&$("#notice-dialog").dialog("open")})}function syncStartup(){chrome.storage.sync.set(startup,function(){})}function setPreferences(){startup.vol=$("#default-master-vol").spinner("value")/10,startup.tempo=$("#default-tempo").spinner("value"),startup.kit=$("#default-kit").val(),$("#default-tooltips").is(":checked")?startup.tooltips=!0:startup.tooltips=!1,syncStartup()}function setEqColor(){startup.eqColor=eqColor,syncStartup()}function sortSelect(e){var t=e.children("option");t.sort(function(e,t){var a=parseInt(e.getAttribute("data-pos")),s=parseInt(t.getAttribute("data-pos"));return a>s?1:a<s?-1:0}),t.detach().appendTo(e)}function setVolIcon(){0==vol?$(".vol-icon").attr("class","vol-icon fa fa-volume-off"):vol>0&&vol<.3?$(".vol-icon").attr("class","vol-icon fa fa-volume-down"):vol>0&&vol>.5&&$(".vol-icon").attr("class","vol-icon fa fa-volume-up")}function initAudio(){audioContext=new(window.AudioContext||window.webkitAudioContext),tuna=new Tuna(audioContext),analyser=audioContext.createAnalyser(),recorderNode=audioContext.createGain(),rec=new Recorder(recorderNode,{workerPath:"js/recorderWorker.js"}),initAudioXtra()}function initAudioXtra(){convolver=new tuna.Convolver({bypass:1}),compressor=new tuna.Compressor({bypass:1}),compThresholdDef=compressor.threshold.value,compRatioDef=compressor.ratio.value,compAttackDef=compressor.attack.value,compReleaseDef=compressor.release.value,compKneeDef=compressor.knee.value,lowpass=new tuna.Filter({filterType:"lowpass",bypass:1}),lowpassFreqDef=lowpass.frequency.value,lowpassQDef=lowpass.Q.value,highpass=new tuna.Filter({filterType:"highpass",bypass:1}),highpassFreqDef=highpass.frequency.value,highpassQDef=highpass.Q.value}function initComponents(){function e(e,t){$(".tooltip-"+e).fadeIn("fast"),setSliderTooltip("tooltip-"+e,e,120).text(t)}function t(e,t){setSliderTooltip("tooltip-"+e,e,120).text(t)}function a(e){$(".tooltip-"+e).fadeOut("fast")}initAudio(),procmarketing(),$.each(kits,function(e,t){$("#kits").append('<option value="'+t.id+'" data-pos = "'+t.pos+'">'+t.name+"</option>"),$("#default-kit").append('<option value="'+t.id+'" data-pos = "'+t.pos+'">'+t.name+"</option>")}),$.each(impulseResponsesInfo,function(e,t){$("#impulses").append('<option value="'+t.id+'" data-pos = "'+t.pos+'">'+t.name+"</option>"),convolverLevels[e]=impulseResponsesInfo[e].level}),$.each(filters,function(e,t){$("#filters").append('<option value="'+t.id+'" data-pos = "'+t.pos+'">'+t.name+"</option>")}),sortSelect($("#kits")),sortSelect($("#default-kit")),sortSelect($("#filters")),$(".panel").draggable({containment:".wrapper"}),initPatterns(),$("#master-vol").slider({step:.1,min:0,max:1,orientation:"horizontal",range:"min",animate:!0,start:function(e,t){$(".tooltip-master-vol").fadeIn("fast"),setSliderTooltip("tooltip-master-vol","master-vol").text(10*t.value)},slide:function(e,t){vol=t.value,setSliderTooltip("tooltip-master-vol","master-vol").text(10*t.value),setVolIcon()},stop:function(e,t){$(".tooltip-master-vol").fadeOut("fast")}}),$("#swing-factor").slider({value:0,step:.1,min:0,max:1,orientation:"horizontal",range:"min",animate:!0,start:function(e,t){$(".tooltip-swing-factor").fadeIn("fast"),setSliderTooltip("tooltip-swing-factor","swing-factor",140).text(10*t.value)},slide:function(e,t){swingFactor=t.value,setSliderTooltip("tooltip-swing-factor","swing-factor",140).text(10*t.value)},stop:function(e,t){$(".tooltip-swing-factor").fadeOut("fast")}}),$("#convolver-level").slider({value:0,step:.1,min:0,max:1,orientation:"horizontal",range:"min",animate:!0,start:function(e,t){$(".tooltip-convolver-level").fadeIn("fast"),setSliderTooltip("tooltip-convolver-level","convolver-level").text(10*t.value)},slide:function(e,t){convolverLevels[impulseIdx]=t.value,setSliderTooltip("tooltip-convolver-level","convolver-level").text(10*t.value)},stop:function(e,t){$(".tooltip-convolver-level").fadeOut("fast")}}),$("#add-compressor").buttonset(),$("#add-lowpass").buttonset(),$("#add-highpass").buttonset(),$("#compressor-threshold").slider({value:compThresholdDef,step:.1,min:-100,max:0,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("compressor-threshold",a.value)},slide:function(e,a){compressor.threshold.value=a.value,t("compressor-threshold",a.value)},stop:function(e,t){a("compressor-threshold")}}),$("#compressor-threshold").dblclick(function(){$(this).slider({value:compThresholdDef})}),$("#compressor-ratio").slider({value:compRatioDef,step:1,min:1,max:20,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("compressor-ratio",a.value)},slide:function(e,a){compressor.ratio.value=a.value,t("compressor-ratio",a.value)},stop:function(e,t){a("compressor-ratio")}}),$("#compressor-ratio").dblclick(function(){$(this).slider({value:compRatioDef})}),$("#compressor-attack").slider({value:compAttackDef,step:1,min:0,max:1e3,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("compressor-attack",a.value)},slide:function(e,a){compressor.attack.value=a.value/1e3,t("compressor-attack",a.value)},stop:function(e,t){a("compressor-attack")}}),$("#compressor-attack").dblclick(function(){$(this).slider({value:compAttackDef})}),$("#compressor-release").slider({value:compReleaseDef,step:1,min:0,max:1e3,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("compressor-release",a.value)},slide:function(e,a){compressor.release.value=a.value/1e3,t("compressor-release",a.value)},stop:function(e,t){a("compressor-release")}}),$("#compressor-release").dblclick(function(){$(this).slider({value:compReleaseDef})}),$("#compressor-knee").slider({value:compKneeDef,step:1,min:0,max:40,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("compressor-knee",a.value)},slide:function(e,a){compressor.knee.value=a.value,t("compressor-knee",a.value)},stop:function(e,t){a("compressor-knee")}}),$("#compressor-knee").dblclick(function(){$(this).slider({value:compKneeDef})}),$("#lowpass-frequency").slider({value:lowpassFreqDef,step:1,min:20,max:22050,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("lowpass-frequency",a.value)},slide:function(e,a){lowpass.frequency.value=a.value,t("lowpass-frequency",a.value)},stop:function(e,t){a("lowpass-frequency")}}),$("#lowpass-frequency").dblclick(function(){$(this).slider({value:lowpassFreqDef})}),$("#lowpass-q").slider({value:lowpassQDef,step:.001,min:.001,max:100,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("lowpass-q",a.value)},slide:function(e,a){lowpass.Q.value=a.value,t("lowpass-q",a.value)},stop:function(e,t){a("lowpass-q")}}),$("#lowpass-q").dblclick(function(){$(this).slider({value:lowpassQDef})}),$("#highpass-frequency").slider({value:highpassFreqDef,step:1,min:20,max:22050,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("highpass-frequency",a.value)},slide:function(e,a){highpass.frequency.value=a.value,t("highpass-frequency",a.value)},stop:function(e,t){a("highpass-frequency")}}),$("#highpass-frequency").dblclick(function(){$(this).slider({value:highpassFreqDef})}),$("#highpass-q").slider({value:highpassQDef,step:.001,min:.001,max:100,orientation:"horizontal",range:"min",animate:!0,start:function(t,a){e("highpass-q",a.value)},slide:function(e,a){highpass.Q.value=a.value,t("highpass-q",a.value)},stop:function(e,t){a("highpass-q")}}),$("#highpass-q").dblclick(function(){$(this).slider({value:highpassQDef})}),$("#tempo, #default-tempo").spinner({min:40,max:240}),$("#default-master-vol").spinner({step:1,min:0,max:10}),$("#clear-dialog").dialog({autoOpen:!1,resizable:!1,closeText:"",position:{my:"center",at:"left top",of:$(".row-b")},buttons:[{text:"Cancel",click:function(){$(this).dialog("close")}},{text:"Ok",click:function(){clearAll(),$(this).dialog("close")}}],close:function(e,t){$("#clear-show").is(":checked")&&(startup.clearDialog=!1,syncStartup()),startup.tooltips&&$("#clear-all").tooltip("close")}}),$("#reset-dialog").dialog({autoOpen:!1,resizable:!1,closeText:"",position:{my:"center",at:"left bottom",of:$(".pref-reset")},buttons:[{text:"Cancel",click:function(){$(this).dialog("close")}},{text:"Ok",click:function(){reset(!0),$(this).dialog("close")}}]}),$("#invalid-file-dialog").dialog({modal:!0,autoOpen:!1,resizable:!1,buttons:{Ok:function(){$(this).dialog("close")}}}),$("#notice-dialog").dialog({autoOpen:!1,resizable:!1,width:425,closeText:"",position:{my:"left+30 bottom-30",at:"left bottom",of:window},buttons:[{text:"Ok",click:function(){$("#notice-show").is(":checked")&&(startup.notice=!1,syncStartup()),$(this).dialog("close")}}]}),$(".ui-dialog").draggable("option","containment",$(".wrapper")),$("#kits, #default-kit").selectmenu({width:134}),$("#impulses").selectmenu({width:136}),$("#filters").selectmenu({width:136}),$("#demos").selectmenu({width:134}),loadDefaults(),setButton("#pattern-0, #pattern-1, #pattern-2, #pattern-3"),setButton("#close-app","ui-icon-power"),setButton("#mini-app","ui-icon-minusthick"),setButton("#record, #play, #open, #save, #reset, #clear, #clear-all"),setButton("#help, #preferences, #save-preferences, #filtering, #panning, #plus"),setButton("#compressor-led, #lowpass-led, #highpass-led"),$("#pattern-0").addClass("activePattern"),setFilter(1),visualize(),createSequencer(),createPanPanel(),getPreferences()}function openFileDialog(e){$("#invalid-file-dialog").dialog("open"),$("#invalid-file-dialog p").html(e)}function loadFile(e){var t=0;reset();try{var a=$.parseJSON(e);if(a)return void loadJSON(a)}catch(e){t++}try{var s=$.parseXML(e);s&&loadXML(s)}catch(e){t++}2==t&&(openFileDialog('<i class="fa fa-ban"></i> Unsupported file format.'),t=0)}function loadDemo(e){if("none"==e)return void(isDemo&&clearAll());isDemo=!0,$(".preload-file").fadeIn(),reset(),$.getJSON("demos/"+e+".json",function(e){loadJSON(e),$(".preload-file").fadeOut()})}function n2b(e){return 1==e}function b2n(e){return 1==e?1:0}function genXML(){var e='<?xml version="1.0" encoding="UTF-8"?>';e+="<drumbit>",e+="<options>",e+="<volume>"+vol+"</volume>",e+="<tempo>"+tempo+"</tempo>",e+="<swing>"+swingFactor+"</swing>",e+="<kit>"+$("#kits").val()+"</kit>",e+='<effect level="'+convolverLevels[impulseIdx]+'">'+impulseIdx+"</effect>",e+='<compressor bypass="'+compressor.bypass+'" threshold="'+compressor.threshold.value+'" ratio="'+compressor.ratio.value+'" attack="'+compressor.attack.value+'" release="'+compressor.release.value+'" knee="'+compressor.knee.value+'" />',e+='<lowpass bypass="'+lowpass.bypass+'" frequency="'+lowpass.frequency.value+'" q="'+lowpass.Q.value+'" />',e+='<highpass bypass="'+highpass.bypass+'" frequency="'+highpass.frequency.value+'" q="'+highpass.Q.value+'" />',e+="</options>";for(var t=0;t<4;t++){e+="<pattern"+(t+1)+">";for(var a=0;a<8;a++){var s=a+1;e+="<track"+s+' vol="'+vols[a]+'" pan="'+pans[a]+'" pitch="'+pitches[a]+'">';for(var o=0;o<16;o++)e+=0==patterns[t][a][o]?"-":"0";e+="</track"+s+">"}e+="</pattern"+(t+1)+">"}return e+="</drumbit>",formatXML(e)}function genJSON(){for(var e={name:"drumbit",edition:"Free",metadata:metadata,options:{volume:vol,tempo:tempo,swing:swingFactor,kit:$("#kits").val(),effect:{id:impulseIdx,level:convolverLevels[impulseIdx]},compressor:{bypass:compressor.bypass,threshold:compressor.threshold.value,ratio:compressor.ratio.value,attack:compressor.attack.value,release:compressor.release.value,knee:compressor.knee.value},lowpass:{bypass:lowpass.bypass,frequency:lowpass.frequency.value,q:lowpass.Q.value},highpass:{bypass:highpass.bypass,frequency:highpass.frequency.value,q:highpass.Q.value}}},t=0;t<4;t++){e["pattern"+(t+1)]={};for(var a=0;a<8;a++){e["pattern"+(t+1)]["track"+(a+1)]={vol:vols[a],pan:pans[a],pitch:pitches[a],steps:[]};for(var s=e["pattern"+(t+1)]["track"+(a+1)],o=0;o<16;o++)s.steps.push(b2n(patterns[t][a][o]))}}return JSON.stringify(e)}function loadXML(e){var t=$(e);if(t.find("drums").length||t.find("tracks").length)return void openFileDialog('<i class="fa fa-exclamation-triangle"></i> Unsupported old version drumbit file.<p>You can open it in the <a href="https://drumbit.app" target="_blank">Web App</a> and save the file in the new format.<p>');if(!t.find("drumbit").length)return void openFileDialog('<i class="fa fa-ban"></i> Invalid drumbit XML data.');var a=t.find("kit").text();if(changeKit(a),vol=t.find("volume").text(),setVolIcon(),$("#master-vol").slider("value",vol),tempo=t.find("tempo").text(),$("#tempo").val(tempo),swingFactor=t.find("swing").text()||0,$("#swing-factor").slider("value",swingFactor),t.find("effect").length&&(impulseIdx=t.find("effect").text(),$("#impulses").val(impulseIdx),$("#impulses").selectmenu("refresh"),impulseIdx>0&&($(".effects-level").show(),convolverLevels[impulseIdx]=t.find("effect").attr("level"),$("#convolver-level").slider("value",convolverLevels[impulseIdx]))),t.find("compressor").length){var s=t.find("compressor");0==s.attr("bypass")&&($("#compressor-on").prop("checked",!0).button("refresh"),$("#compressor-led").addClass("led-on"),compressor.bypass=0),compressor.threshold.value=s.attr("threshold"),$("#compressor-threshold").slider("value",compressor.threshold.value),compressor.attack.value=s.attr("attack"),$("#compressor-attack").slider("value",compressor.attack.value),compressor.release.value=s.attr("release"),$("#compressor-release").slider("value",compressor.release.value),compressor.ratio.value=s.attr("ratio"),$("#compressor-ratio").slider("value",compressor.ratio.value),compressor.knee.value=s.attr("knee"),$("#compressor-knee").slider("value",compressor.knee.value)}if(t.find("lowpass").length){var o=t.find("lowpass");0==o.attr("bypass")&&($("#lowpass-on").prop("checked",!0).button("refresh"),$("#lowpass-led").addClass("led-on"),lowpass.bypass=0),lowpass.frequency.value=o.attr("frequency"),$("#lowpass-frequency").slider("value",lowpass.frequency.value),lowpass.Q.value=o.attr("q"),$("#lowpass-q").slider("value",lowpass.Q.value)}if(t.find("highpass").length){var r=t.find("highpass");0==r.attr("bypass")&&($("#highpass-on").prop("checked",!0).button("refresh"),$("#highpass-led").addClass("led-on"),highpass.bypass=0),highpass.frequency.value=r.attr("frequency"),$("#highpass-frequency").slider("value",highpass.frequency.value),highpass.Q.value=r.attr("q"),$("#highpass-q").slider("value",highpass.Q.value)}var i=[0,1,2,3,4,5,6,7];1==a?i=[0,3,1,2,4,5,6,7]:8==a&&(i=[0,1,2,3,5,4,6,7]);for(var n=0;n<4;n++)t.find("pattern"+(n+1)).each(function(){for(var e=0;e<8;e++)for(var t=$(this).find("track"+(i[e]+1)).text().split(""),a=0;a<16;a++){var s=!1;"0"==t[a]&&(s=!0),patterns[n][e][a]=s}}),selPattern=n,procPatternFilled();for(var n=0;n<8;n++){var l=t.find("track"+(n+1)).attr("vol");vols[n]=l,$("#track-vol-"+n).slider("value",l);var c=t.find("track"+(n+1)).attr("pan");c&&(pans[n]=c,$("#track-pan-"+n).slider("value",c));var p=t.find("track"+(n+1)).attr("pitch");p&&(pitches[n]=p,$("#pitch-"+n).slider("value",p))}selPattern=0,setStepButtons()}function loadJSON(e){if(!e.name)return void openFileDialog('<i class="fa fa-ban"></i> Invalid drumbit JSON data.');initAudioXtra();var t=e.edition||null;e.metadata&&(metadata.author=e.metadata.author,metadata.title=e.metadata.title,metadata.remarks=e.metadata.remarks),changeKit(e.options.kit),tempo=e.options.tempo,$("#tempo").val(tempo),swingFactor=e.options.swing||0,$("#swing-factor").slider("value",swingFactor),impulseIdx=e.options.effect.id,$("#impulses").val(impulseIdx),$("#impulses").selectmenu("refresh"),impulseIdx>0&&($(".effects-level").show(),convolverLevels[impulseIdx]=e.options.effect.level,convolver=new tuna.Convolver({level:impulseResponsesInfo[impulseIdx].level,impulse:impulseResponsesInfo[impulseIdx].url,bypass:0}),$("#convolver-level").slider("value",convolverLevels[impulseIdx])),0==e.options.compressor.bypass&&($("#compressor-on").prop("checked",!0).button("refresh"),$("#compressor-led").addClass("led-on"),compressor.bypass=0),compressor.threshold.value=e.options.compressor.threshold,$("#compressor-threshold").slider("value",compressor.threshold.value),compressor.attack.value=e.options.compressor.attack,$("#compressor-attack").slider("value",compressor.attack.value),compressor.release.value=e.options.compressor.release,$("#compressor-release").slider("value",compressor.release.value),compressor.ratio.value=e.options.compressor.ratio,$("#compressor-ratio").slider("value",compressor.ratio.value),compressor.knee.value=e.options.compressor.knee,$("#compressor-knee").slider("value",compressor.knee.value),0==e.options.lowpass.bypass&&($("#lowpass-on").prop("checked",!0).button("refresh"),$("#lowpass-led").addClass("led-on"),lowpass.bypass=0),lowpass.frequency.value=e.options.lowpass.frequency,$("#lowpass-frequency").slider("value",lowpass.frequency.value),lowpass.Q.value=e.options.lowpass.q,$("#lowpass-q").slider("value",lowpass.Q.value),0==e.options.highpass.bypass&&($("#highpass-on").prop("checked",!0).button("refresh"),$("#highpass-led").addClass("led-on"),highpass.bypass=0),highpass.frequency.value=e.options.highpass.frequency,$("#highpass-frequency").slider("value",highpass.frequency.value),highpass.Q.value=e.options.highpass.q,$("#highpass-q").slider("value",highpass.Q.value);var a=e;"Plus"==t&&(a=a.bank1,openFileDialog('<i class="fa fa-exclamation-triangle"></i> This file was created with the <a href="https://chrome.google.com/webstore/detail/drumbit-plus/ibljjpnohhiphakedmfkklinogeomelb" target="_blank" class="plus-link">Plus edition</a>.<p>Not all features are supported.</p>'));var s=[0,1,2,3,4,5,6,7];t||(1==e.options.kit?s=[0,3,1,2,4,5,6,7]:8==e.options.kit&&(s=[0,1,2,3,5,4,6,7]));for(var o=0;o<4;o++){for(var r=0;r<8;r++){var i=a["pattern"+(o+1)]["track"+(s[r]+1)];vols[r]=i.vol,$("#track-vol-"+r).slider("value",i.vol),pans[r]=i.pan,$("#track-pan-"+r).slider("value",i.pan),pitches[r]=i.pitch,$("#pitch-"+r).slider("value",i.pitch);for(var n=0;n<16;n++)patterns[o][r][n]=n2b(i.steps[n])}selPattern=o,procPatternFilled()}selPattern=0,setStepButtons(),isDemo&&$("#play").trigger("click")}function setTracks2Play(){if(patternFilled(0)){loopLength=16;for(var e=0;e<8;e++)for(var t=0;t<16;t++)tracks[e][t]=patterns[0][e][t]}if(patternFilled(0)&&patternFilled(1)){loopLength=32;for(var e=0;e<8;e++)for(var t=0;t<16;t++)tracks[e][t+16]=patterns[1][e][t]}if(patternFilled(0)&&patternFilled(1)&&patternFilled(2)){loopLength=48;for(var e=0;e<8;e++)for(var t=0;t<16;t++)tracks[e][t+32]=patterns[2][e][t]}if(patternFilled(0)&&patternFilled(1)&&patternFilled(2)&&patternFilled(3)){loopLength=64;for(var e=0;e<8;e++)for(var t=0;t<16;t++)tracks[e][t+48]=patterns[3][e][t]}}function schedule(){var e=audioContext.currentTime;for(e-=startTime;noteTime<e+.2;){var t=noteTime+startTime;tracks[0][rhythmIndex]&&playSample(0,t),tracks[1][rhythmIndex]&&playSample(1,t),tracks[2][rhythmIndex]&&playSample(2,t),tracks[3][rhythmIndex]&&playSample(3,t),tracks[4][rhythmIndex]&&playSample(4,t),tracks[5][rhythmIndex]&&playSample(5,t),tracks[6][rhythmIndex]&&playSample(6,t),tracks[7][rhythmIndex]&&playSample(7,t),noteTime!=lastDrawTime&&(lastDrawTime=noteTime,playhead((rhythmIndex+15)%16),$(".patterns").removeClass("activePattern"),rhythmIndex<16?selPattern=0:rhythmIndex>15&&rhythmIndex<32?selPattern=1:rhythmIndex>31&&rhythmIndex<48?selPattern=2:rhythmIndex>47&&(selPattern=3),$("#pattern-"+selPattern).addClass("activePattern"),setStepButtons()),advanceNote()}timeoutId=setTimeout(schedule,0)}function formatXML(e){var t="";e=e.replace(/(>)(<)(\/*)/g,"$1\r\n$2$3");var a=0;return $.each(e.split("\r\n"),function(e,s){var o=0;s.match(/.+<\/\w[^>]*>$/)?o=0:s.match(/^<\/\w/)?0!=a&&(a-=1):o=s.match(/^<\w[^>]*[^\/]>.*$/)?1:0;for(var r="",i=0;i<a;i++)r+="  ";t+=r+s+"\r\n",a+=o}),t}function patternFilled(e){return $("#pattern-"+e).hasClass("patternFilled")}function isPatternsEmpty(){var e=!0;return $(".patterns").hasClass("patternFilled")&&(e=!1),e}function getPtrnPos(){var e=0;return 1==selPattern?e=16:2==selPattern?e=32:3==selPattern&&(e=48),e}function initPatterns(){for(var e=0;e<4;e++){for(var t=new Array(8),a=0;a<t.length;a++){t[a]=new Array(16);for(var s=0;s<16;s++)t[a][s]=!1}patterns[e]=t}for(var a=0;a<tempPattern.length;a++){tempPattern[a]=new Array(16);for(var s=0;s<16;s++)tempPattern[a][s]=!1}for(var a=0;a<8;a++){tracks[a]=new Array(64);for(var s=0;s<64;s++)tracks[a][s]=!1}}function pad(e){return e>9?e:"0"+e}function hasAnyStepsOn(e){for(var t=0,a=0;a<8;a++)$.inArray(!0,e[a])>-1&&(t+=1);return t>0}function procPatternFilled(){for(var e=0,t=0;t<patterns[selPattern].length;t++)$.inArray(!0,patterns[selPattern][t])>-1&&(e+=1),e>0?$("#pattern-"+selPattern).addClass("patternFilled"):$("#pattern-"+selPattern).removeClass("patternFilled")}function clear(){for(var e=0;e<8;e++)for(var t=0;t<16;t++)patterns[selPattern][e][t]=!1;for(var a=getPtrnPos(),e=0;e<8;e++)for(var t=0;t<16;t++)tracks[e][t+a]=!1;$("#pattern-"+selPattern).removeClass("patternFilled"),$(".step-buttons").removeClass("step-button-sel"),kit.stop(),isPlaying=!1,$("#play i").removeClass("fa-stop").addClass("fa-play")}function clearAll(){selPattern=0,initPatterns(),$(".step-buttons").removeClass("step-button-sel"),$(".patterns").removeClass("patternFilled"),$(".patterns").removeClass("activePattern"),$("#pattern-"+selPattern).addClass("activePattern"),isDemo||($("#demos").val("none"),$("#demos").selectmenu("refresh")),kit.stop(),isPlaying=!1,$("#play i").removeClass("fa-stop").addClass("fa-play"),resetPanVolsPitches()}function resetPanVolsPitches(){vols=[],pans=[],pitches=[];for(var e=0;e<8;e++)vols.push(1),$("#track-vol-"+e).slider("value",1),pitches.push(1),$("#pitch-"+e).slider("value",1),pans.push(1),$("#track-pan-"+e).slider("value",1)}function resetEffectsFilters(){impulseIdx=0,$("#impulses").val(impulseIdx),$("#impulses").selectmenu("refresh"),$(".effects-level").hide(),$("#compressor-off, #lowpass-off, #highpass-off").prop("checked",!0).button("refresh"),$(".filters-leds button").removeClass("led-on"),compressor=new tuna.Compressor({bypass:1}),lowpass=new tuna.Filter({filterType:"lowpass",bypass:1}),highpass=new tuna.Filter({filterType:"highpass",bypass:1}),$("#compressor-threshold").slider("value",compressor.threshold.value),$("#compressor-ratio").slider("value",compressor.ratio.value),$("#compressor-release").slider("value",compressor.release.value),$("#compressor-attack").slider("value",compressor.attack.value),$("#compressor-knee").slider("value",compressor.knee.value),$("#lowpass-frequency, #highpass-frequency").slider("value",lowpass.frequency.value),$("#lowpass-q, #highpass-q").slider("value",lowpass.Q.value)}function reset(e){e=e||!1,e?(tempo=80,vol=.7,$("#default-tempo").spinner("value",tempo),$("#default-master-vol").spinner("value",10*vol),$("#default-kit").val("1"),$("#default-kit").selectmenu("refresh"),$("#default-tooltips").prop("checked",!0),$("#clear-show").prop("checked",!1),$("#tempo").spinner("value",tempo),$("#master-vol").slider("value",vol),$("#swing-factor").slider("value",0),swingFactor=0,$("#demos").val("none"),$("#demos").selectmenu("refresh"),isDemo=!1,changeKit(1),resetPanVolsPitches(),resetEffectsFilters(),startup.clearDialog=!0,startup.notice=!0,setPreferences()):(clearAll(),resetEffectsFilters())}function setStepButtons(){$(".step-buttons").removeClass("step-button-sel"),$(".step-buttons").each(function(){var e=$(this).attr("data-track"),t=$(this).attr("data-step");1==patterns[selPattern][e][t]&&$(this).addClass("step-button-sel")})}function setPattern(e){selPattern=e,$(".patterns").removeClass("activePattern"),$("#pattern-"+selPattern).addClass("activePattern"),setStepButtons()}function stopRec(){kit.stop(),kit.stopRecording(),$("#record i").removeClass("fa-stop").addClass("fa-circle"),$("#record").removeClass("recording"),$("#open, #cleal-all, #clear, .patterns, #play").prop("disabled",!1),$("#rec").hide(),sec=0,clearInterval(timer)}function startRec(){kit.play(),kit.record(),$("#record i").removeClass("fa-circle").addClass("fa-stop"),$("#record").addClass("recording"),$("#open, #cleal-all, #clear, .patterns, #play").prop("disabled",!0),$("#rec").show()}function ads(){function e(e){return a[s].html}function t(){$("#marketing div").fadeOut(function(){$("#marketing div").html(e(s)).fadeIn()}),s==a.length-1?s=0:s++}var a=[{
html:'<a href="https://drumbit.app/" target="_blank"><img src="css/images/drumbit-webapp-ad.png" /></a>'},{html:'<a href="https://chrome.google.com/webstore/detail/drumbit-plus/ibljjpnohhiphakedmfkklinogeomelb" target="_blank"><img src="css/images/drumbit-plus-ad.png" /></a>'},{html:'<a href="https://drumbit.club/" target="_blank"><img src="css/images/drumbit-club-ad.png"></a>'}],s=-1;t(),setInterval(t,5e3)}function procmarketing(){var e=Math.floor(2*Math.random());e=1,1===e?(marketing=!0,ads()):$("#marketing").hide()}var kits=[{id:1,name:"Kit 1",pos:1,info:[{url:"kits/kit-1/crash.wav",name:"crash"},{url:"kits/kit-1/high-tom.wav",name:"high tom"},{url:"kits/kit-1/medium-tom.wav",name:"medium tom"},{url:"kits/kit-1/low-tom.wav",name:"low tom"},{url:"kits/kit-1/hihat-op.wav",name:"open hihat"},{url:"kits/kit-1/hihat-cl.wav",name:"closed Hihat"},{url:"kits/kit-1/snare.wav",name:"snare"},{url:"kits/kit-1/kick.wav",name:"kick"}]},{id:2,name:"Kit 2",pos:2,info:[{url:"kits/kit-2/crash.wav",name:"crash"},{url:"kits/kit-2/wood.wav",name:"wood"},{url:"kits/kit-2/bongo-2.wav",name:"bongo 2"},{url:"kits/kit-2/bongo-1.wav",name:"bongo 1"},{url:"kits/kit-2/hihat-op.wav",name:"open hihat"},{url:"kits/kit-2/hihat-cl.wav",name:"closed hihat"},{url:"kits/kit-2/snare.wav",name:"snare"},{url:"kits/kit-2/kick.wav",name:"kick"}]},{id:3,name:"Kit 3",pos:3,info:[{url:"kits/kit-3/clave.wav",name:"clave"},{url:"kits/kit-3/perc-3.wav",name:"percussion 3"},{url:"kits/kit-3/perc-2.wav",name:"percussion 2"},{url:"kits/kit-3/perc-1.wav",name:"percussion 1"},{url:"kits/kit-3/hihat-op.wav",name:"open hihat"},{url:"kits/kit-3/hihat-cl.wav",name:"closed hihat"},{url:"kits/kit-3/snare.wav",name:"snare"},{url:"kits/kit-3/kick.wav",name:"kick"}]},{id:4,name:"Jazz",pos:5,info:[{url:"kits/jazz/brush.wav",name:"brush"},{url:"kits/jazz/perc-4.wav",name:"percussion 4"},{url:"kits/jazz/perc-3.wav",name:"percussion 3"},{url:"kits/jazz/perc-2.wav",name:"percussion 2"},{url:"kits/jazz/perc-1.wav",name:"percussion 1"},{url:"kits/jazz/hihat.wav",name:"hihat"},{url:"kits/jazz/snare.wav",name:"snare"},{url:"kits/jazz/bass-drum.wav",name:"bass drum"}]},{id:5,name:"Hip Hop",pos:6,info:[{url:"kits/hip-hop/fx.wav",name:"fx"},{url:"kits/hip-hop/cow.wav",name:"cowbell"},{url:"kits/hip-hop/perc-3.wav",name:"percussion 3"},{url:"kits/hip-hop/perc-2.wav",name:"percussion 2"},{url:"kits/hip-hop/perc-1.wav",name:"percussion 1"},{url:"kits/hip-hop/hihat.wav",name:"hihat"},{url:"kits/hip-hop/snare.wav",name:"snare"},{url:"kits/hip-hop/bass-drum.wav",name:"bass drum"}]},{id:6,name:"RnB",pos:8,info:[{url:"kits/rnb/cymbal.wav",name:"cymbal"},{url:"kits/rnb/clap.wav",name:"clap"},{url:"kits/rnb/perc-3.wav",name:"percussion 3"},{url:"kits/rnb/perc-2.wav",name:"percussion 2"},{url:"kits/rnb/perc-1.wav",name:"percussion 1"},{url:"kits/rnb/hihat.wav",name:"hihat"},{url:"kits/rnb/snare.wav",name:"snare"},{url:"kits/rnb/bass-drum.wav",name:"bass drum"}]},{id:7,name:"House",pos:9,info:[{url:"kits/house/clap.wav",name:"clap"},{url:"kits/house/perc-2.wav",name:"percussion 2"},{url:"kits/house/perc-1.wav",name:"percussion 1"},{url:"kits/house/tom-2.wav",name:"tom 2"},{url:"kits/house/tom-1.wav",name:"tom 1"},{url:"kits/house/hihat.wav",name:"hihat"},{url:"kits/house/snare.wav",name:"snare"},{url:"kits/house/bass-drum.wav",name:"bass drum"}]},{id:8,name:"DrumNBass",pos:10,info:[{url:"kits/dnb/china-cymbal.wav",name:"china cymbal"},{url:"kits/dnb/clap.wav",name:"clap"},{url:"kits/dnb/tom-2.wav",name:"tom 2"},{url:"kits/dnb/tom-1.wav",name:"tom 1"},{url:"kits/dnb/stick-snare.wav",name:"stick snare"},{url:"kits/dnb/hihat.wav",name:"hihat"},{url:"kits/dnb/snare.wav",name:"snare"},{url:"kits/dnb/kick.wav",name:"kick"}]},{id:9,name:"Dubstep",pos:11,info:[{url:"kits/dubstep/claps.wav",name:"claps"},{url:"kits/dubstep/shaker.wav",name:"shaker"},{url:"kits/dubstep/crash.wav",name:"crash"},{url:"kits/dubstep/cymbal.wav",name:"cymbal"},{url:"kits/dubstep/tom.wav",name:"tom"},{url:"kits/dubstep/hihat.wav",name:"hihat"},{url:"kits/dubstep/snare.wav",name:"snare"},{url:"kits/dubstep/kick.wav",name:"kick"}]},{id:10,name:"Indian",pos:13,info:[{url:"kits/indian/tabla-2.wav",name:"tabla 2"},{url:"kits/indian/tabla-1.wav",name:"tabla 1"},{url:"kits/indian/nagara.wav",name:"nagara"},{url:"kits/indian/udukkai.wav",name:"udukkai"},{url:"kits/indian/ghatam.wav",name:"ghatam"},{url:"kits/indian/dukki-tarang.wav",name:"dukki tarang"},{url:"kits/indian/dholak.wav",name:"dholak"},{url:"kits/indian/bass-dholak.wav",name:"bass dholak"}]},{id:11,name:"FX",pos:14,info:[{url:"kits/fx/effect-4.wav",name:"effect 4"},{url:"kits/fx/effect-3.wav",name:"effect 3"},{url:"kits/fx/effect-2.wav",name:"effect 2"},{url:"kits/fx/effect-1.wav",name:"effect 1"},{url:"kits/fx/tom.wav",name:"tom"},{url:"kits/fx/hihat.wav",name:"hihat"},{url:"kits/fx/snare.wav",name:"snare"},{url:"kits/fx/kick.wav",name:"kick"}]},{id:12,name:"Kit 4",pos:4,info:[{url:"kits/kit-4/crash.wav",name:"crash"},{url:"kits/kit-4/ride.wav",name:"ride"},{url:"kits/kit-4/rack-tom.wav",name:"rack tom"},{url:"kits/kit-4/floor-tom.wav",name:"floor tom"},{url:"kits/kit-4/hihat-open.wav",name:"open hihat"},{url:"kits/kit-4/hihat-closed.wav",name:"closed hihat"},{url:"kits/kit-4/snare.wav",name:"snare"},{url:"kits/kit-4/kick.wav",name:"kick"}]},{id:13,name:"Latin",pos:12,info:[{url:"kits/kit-4/ride.wav",name:"ride"},{url:"kits/latin/timbale-2.wav",name:"timbale 2"},{url:"kits/latin/timbale-1.wav",name:"timbale 1"},{url:"kits/latin/rim-shot.wav",name:"rim shot"},{url:"kits/kit-4/hihat-open.wav",name:"open hihat"},{url:"kits/kit-4/hihat-closed.wav",name:"closed hihat"},{url:"kits/kit-4/snare.wav",name:"snare"},{url:"kits/kit-4/kick.wav",name:"kick"}]},{id:14,name:"Beatbox",pos:7,info:[{url:"kits/beatbox/crash.wav",name:"crash"},{url:"kits/beatbox/perc-3.wav",name:"percussion 3"},{url:"kits/beatbox/perc-2.wav",name:"percussion 2"},{url:"kits/beatbox/perc-1.wav",name:"percussion 1"},{url:"kits/beatbox/hihat-op.wav",name:"hihat open"},{url:"kits/beatbox/hihat.wav",name:"hihat"},{url:"kits/beatbox/snare.wav",name:"snare"},{url:"kits/beatbox/kick.wav",name:"kick"}]}],impulseResponsesInfo=[{id:0,pos:1,name:"No Effect",url:"undefined",level:0},{id:1,pos:2,name:"Room 1",url:"impulse-responses/room1.wav",level:.8},{id:2,pos:3,name:"Room 2",url:"impulse-responses/room2.wav",level:.8},{id:3,pos:4,name:"Medium Hall 1",url:"impulse-responses/medium-hall1.wav",level:.5},{id:4,pos:5,name:"Medium Hall 2",url:"impulse-responses/medium-hall2.wav",level:.5},{id:5,pos:6,name:"Large Hall",url:"impulse-responses/large-hall.wav",level:.5},{id:6,pos:7,name:"Spring Reverb",url:"impulse-responses/spring-reverb.wav",level:.5},{id:7,pos:9,name:"Muffler",url:"impulse-responses/muffler.wav",level:.8}],filters=[{id:1,pos:1,name:"Compressor"},{id:2,pos:2,name:"Low-pass"},{id:3,pos:3,name:"High-pass"}],startup={vol:.7,tempo:80,kit:1,tooltips:!0,clearDialog:!0,eqColor:"red",notice:!0},CANVAS_BG="#202020",eqColor,audioContext,tuna,analyser,samples=[],timeoutId,startTime,loopLength=16,rhythmIndex=0,noteTime=0,lastDrawTime=-1,barCount=0,isPlaying=!1,isRecording=!1,vol,vols=[],tempo,kit,canvas=document.querySelector(".visualizer"),canvasContext=canvas.getContext("2d"),drawVisual,fileNum=1,selPattern=0,patterns=[],tracks=new Array(8),tempPattern=new Array(8),recorderNode,rec,timer,sec=0,prefPanelVisible=!1,panPanelVisible=!1,filtersPanelVisible=!1,copyPasteVisible=!1,MAX_SWING=.8,swingFactor=0,pitches=[],pans=[],convolver,convolverLevels=[],impulseIdx=0,compressor,compThresholdDef,compRatioDef,compAttackDef,compReleaseDef,compKneeDef,lowpass,lowpassFreqDef,lowpassQDef,highpass,highpassFreqDef,highpassQDef,toolTipStr="#open, #save, #clear-all, #clear, #help, #preferences, #filtering, #panning, #plus",isDemo=!1,metadata={author:"",title:"",remarks:""};Kit.prototype.load=function(){if(!this.startedLoading){this.startedLoading=!0;for(var e=0;e<this.urls.length;e++)this.loadSamples(e,this.urls[e]);samples=this.samples}},Kit.prototype.loadSamples=function(e,t){var a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="arraybuffer";var s=this;$(".preload-kit").fadeIn(),$("#kits-button .ui-icon-triangle-1-s").css("display","none"),a.onload=function(){audioContext.decodeAudioData(a.response,function(t){s.samples[e]=t,++s.samplesLoadCount==s.samplesCount&&(s.isLoaded=!0,$(".preload-kit").fadeOut(),$("#kits-button .ui-icon-triangle-1-s").css("display","block"))},function(e){console.error("decodeAudioData error")})},a.onerror=function(){console.error("request has failed")},a.send()},Kit.prototype.play=function(){noteTime=0,startTime=audioContext.currentTime+.005,setTracks2Play(),schedule()},Kit.prototype.stop=function(){clearTimeout(timeoutId);var e=document.getElementById("led"+(rhythmIndex+14)%16);e.style.backgroundColor="#3f3f3f",e.style.color="#35cac5",rhythmIndex=0,$(".bar-num").removeClass("bar-sel")},Kit.prototype.record=function(){rec.record()},Kit.prototype.stopRecording=function(){rec.stop(),$("#gen-wav").show(),rec.exportWAV(function(e){chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:"drumbit.wav",accepts:[{description:"Waveform Audio File Format",extensions:["wav"]}]},function(t){t.createWriter(function(t){t.onerror=a,t.onwriteend=function(e){},t.write(e)},a);var a=function(e){console.log("ERROR: "+e)}}),$("#gen-wav").hide()}),rec.clear()},$(function(){function e(){for(var e=0;e<8;e++)for(var t=0;t<16;t++)tempPattern[e][t]=patterns[selPattern][e][t]}function t(){for(var e=0;e<8;e++)for(var t=0;t<16;t++)patterns[selPattern][e][t]=tempPattern[e][t];setPattern(selPattern),procPatternFilled()}initComponents();var a=$("#notice-dialog").parent();a.find("button.ui-dialog-titlebar-close").remove(),a.find(".ui-widget-header").css({background:"#ffa500",color:"#000","font-size":"16px"}),$(".step-buttons").click(function(){startAudio(),isDemo=!1;var e=$(this).attr("data-track"),t=$(this).attr("data-step"),a=getPtrnPos();e=parseInt(e),t=parseInt(t),patterns[selPattern][e][t]=!patterns[selPattern][e][t],tracks[e][t+a]=!tracks[e][t+a],$(this).toggleClass("step-button-sel"),patterns[selPattern][e][t]&&playSample(e,0),$("#marketing").is(":visible")&&$("#marketing").hide(),procPatternFilled(),isPlaying&&setTracks2Play()}),$(".patterns").click(function(){setPattern($(this).text()-1)}),$("#play").click(function(e){startAudio(),isPlaying?(kit.stop(),$("#play i").removeClass("fa-stop").addClass("fa-play"),$("#marketing").is(":visible")&&$("#marketing").hide(),stopVisualize()):(kit.play(),$("#play i").removeClass("fa-play").addClass("fa-stop"),marketing&&$("#marketing").hide(),visualize()),$(this).removeClass("ui-state-focus"),isPlaying=!isPlaying}),$("#record").click(function(){isPlaying&&(kit.stop(),$("#play i").removeClass("fa-stop").addClass("fa-play")),isRecording?stopRec():(startRec(),timer=setInterval(function(){$("#seconds").html(pad(++sec%60)),$("#minutes").html(pad(parseInt(sec/60,10))),900==sec&&(stopRec(),isRecording=!1)},1e3)),$(this).removeClass("ui-state-focus"),isRecording=!isRecording}),$(".track-vol").dblclick(function(){$(this).slider({value:1}),vols[this.id.split("-")[2]]=1}),$(".track-pan").dblclick(function(){$(this).slider({value:0}),pans[this.id.split("-")[2]]=0}),$("#master-vol").dblclick(function(){$(this).slider({value:0}),vol=0,$(".vol-icon").attr("class","vol-icon fa fa-volume-off")}),$("#swing-factor").dblclick(function(){$(this).slider({value:0}),swingFactor=0}),$(".pitch").dblclick(function(){$(this).slider({value:1}),pitches[this.id.split("-")[1]]=1}),$("#clear-all").click(function(){isDemo=!1,startup.clearDialog?$("#clear-dialog").dialog("open"):clearAll(),$(this).removeClass("ui-state-focus")}),$("#reset").click(function(){$("#reset-dialog").dialog("open")}),$(".eq-color").click(function(){$(".eq-color").removeClass("eq-color-sel"),eqColor=$(this).attr("id"),$(this).addClass("eq-color-sel"),setEqColor()}),$("#close-app").click(function(){chrome.app.window.current().close()}),$("#mini-app").click(function(e){chrome.app.window.current().minimize()}),$("#clear").click(function(){clear(),$(this).removeClass("ui-state-focus")}),$("#tempo").on("spin",function(e,t){tempo=$("#tempo").spinner("value")}),$("#tempo").on("spinchange",function(e,t){tempo=$("#tempo").spinner("value")}),$("#kits").on("selectmenuchange",function(e,t){setKit(t.item.value)}),$("#filters").on("selectmenuchange",function(e,t){setFilter(t.item.value)}),$("#impulses").on("selectmenuchange",function(e,t){impulseIdx=t.item.value,$("#convolver-level").slider("value",convolverLevels[impulseIdx]),impulseIdx>0?(convolver=new tuna.Convolver({level:impulseResponsesInfo[impulseIdx].level,impulse:impulseResponsesInfo[impulseIdx].url,bypass:0}),$(".effects-level").show()):(convolver.bypass=1,$(".effects-level").hide())}),$("#add-compressor").on("change",function(e,t){"compressor-on"==e.target.id?(compressor.bypass=0,$("#compressor-led").addClass("led-on")):(compressor.bypass=1,$("#compressor-led").removeClass("led-on"))}),$("#add-lowpass").on("change",function(e,t){"lowpass-on"==e.target.id?(lowpass.bypass=0,$("#lowpass-led").addClass("led-on")):(lowpass.bypass=1,$("#lowpass-led").removeClass("led-on"))}),$("#add-highpass").on("change",function(e,t){"highpass-on"==e.target.id?(highpass.bypass=0,$("#highpass-led").addClass("led-on")):(highpass.bypass=1,$("#highpass-led").removeClass("led-on"))}),$(".filters-leds").on("click","button",function(){var e=$(this).attr("id");"compressor-led"==e?0==compressor.bypass?$("#compressor-off").trigger("click"):$("#compressor-on").trigger("click"):"lowpass-led"==e?0==lowpass.bypass?$("#lowpass-off").trigger("click"):$("#lowpass-on").trigger("click"):"highpass-led"==e&&(0==highpass.bypass?$("#highpass-off").trigger("click"):$("#highpass-on").trigger("click"))}),$(".filters-leds").on("click","span",function(){var e=$(this).text();filtersPanelVisible||$("#filtering").trigger("click"),"Compressor"==e?($("#filters").val(1),setFilter(1)):"Low"==e?($("#filters").val(2),setFilter(2)):"High Pass"==e&&($("#filters").val(3),setFilter(3)),$("#filters").selectmenu("refresh")}),$("#demos").on("selectmenuchange",function(e,t){loadDemo(t.item.value)}),$("#data").click(function(e){e.stopPropagation()}),$(".patterns").bind("contextmenu",function(e){e.preventDefault();var t=$(this).attr("id").split("-")[1];$(".copy-paste").show(),copyPasteVisible=!0,$(".copy-paste").css("left",$(this).position().left-9),setPattern(t),patternFilled(t)?$("#copy").removeClass("disabled"):$("#copy").addClass("disabled"),hasAnyStepsOn(tempPattern)?$("#paste").removeClass("disabled"):$("#paste").addClass("disabled")}),$(".copy-paste, body").click(function(){$(".copy-paste").hide(),copyPasteVisible=!1}),$(".copy-paste span").click(function(){"copy"==$(this).attr("id")?e():t()}),$(".btn-panels").click(function(){var e=$(this).attr("id");$("#preferences, #panning, #filtering").css("color","#aaa"),$(".preferences-panel, .panning-panel, .filters-panel").hide(),"preferences"==e?(panPanelVisible=filtersPanelVisible=!1,prefPanelVisible?($(".preferences-panel").hide(),$(this).removeClass("ui-state-focus")):($(".preferences-panel").show(),$(this).css("color","#35cac5")),prefPanelVisible=!prefPanelVisible):"panning"==e?(prefPanelVisible=filtersPanelVisible=!1,panPanelVisible?($(".panning-panel").hide(),$(this).removeClass("ui-state-focus")):($(".panning-panel").show(),$(this).css("color","#35cac5")),panPanelVisible=!panPanelVisible):"filtering"==e&&(prefPanelVisible=panPanelVisible=!1,filtersPanelVisible?($(".filters-panel").hide(),$(this).removeClass("ui-state-focus")):($(".filters-panel").show(),$(this).css("color","#35cac5")),filtersPanelVisible=!filtersPanelVisible)}),$("#save-preferences").click(function(){setPreferences(),$(".preferences-panel").hide(),$("#preferences").css("color","#aaa"),prefPanelVisible=!1}),$("#close-preferences").click(function(){$(".preferences-panel").hide(),$("#preferences").css("color","#aaa"),prefPanelVisible=!1}),$("#close-panning").click(function(){$(".panning-panel").hide(),$("#panning").css("color","#aaa"),panPanelVisible=!1}),$("#close-filters").click(function(){$(".filters-panel").hide(),$("#filtering").css("color","#aaa"),filtersPanelVisible=!1}),$("button").bind("keydown",function(e){void 0!==$(this).attr("id")&&(e.keyCode!=$.ui.keyCode.SPACE&&e.keyCode!=$.ui.keyCode.ENTER||e.preventDefault())}),$(document).keydown(function(a){32==a.keyCode&&(isRecording||$("#play").trigger("click")),a.ctrlKey&&32==a.keyCode&&$("#record").trigger("click"),27==a.keyCode&&($("#preferences, #panning, #filtering").removeClass("ui-state-focus").css("color","#aaa"),prefPanelVisible&&($(".preferences-panel").hide(),prefPanelVisible=!1),panPanelVisible&&($(".panning-panel").hide(),panPanelVisible=!1),filtersPanelVisible&&($(".filters-panel").hide(),filtersPanelVisible=!1),copyPasteVisible&&($(".copy-paste").hide(),copyPasteVisible=!1)),a.ctrlKey&&67==a.keyCode?patternFilled(selPattern)&&e():a.ctrlKey&&86==a.keyCode?hasAnyStepsOn(tempPattern)&&t():a.ctrlKey&&79==a.keyCode?$("#open").get(0).click():a.ctrlKey&&83==a.keyCode?$("#save").get(0).click():a.ctrlKey&&65==a.keyCode?$("#clear-all").trigger("click"):76==a.keyCode&&a.ctrlKey?$("#clear").trigger("click"):80==a.keyCode&&a.ctrlKey?$("#preferences").trigger("click"):72==a.keyCode&&a.ctrlKey?$("#help").get(0).click():71==a.keyCode&&a.ctrlKey?$("#panning").get(0).click():70==a.keyCode&&a.ctrlKey&&$("#filtering").get(0).click()}),$(".ui-slider-range").mousedown(function(){$(".ui-slider-handle").css("background","#202020 url(../css/images/ui-bg_inset-soft_40_202020_1x100.png) 50% 50% repeat-x")}),$("#save").click(function(e){isRecording&&e.preventDefault();var t="Pattern "+fileNum+".json";fileNum++,chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:t,accepts:[{description:"JSON File Format",extensions:["json"]}]},function(e){e.createWriter(function(e){e.onerror=t,e.onwriteend=function(e){},e.write(new Blob([genJSON()],{type:"application/json"}))},t);var t=function(e){console.log("ERROR: "+e)}})}),$(toolTipStr).click(function(){$(":focus").blur()}),$("#open").click(function(){var e=[{description:"JSON, XML",mimeTypes:["application/json","application/xml"],extensions:["json","xml"]}];chrome.fileSystem.chooseEntry({type:"openFile",accepts:e},function(e){e.file(function(e){var t=new FileReader;isDemo=!1,$(".preload-file").fadeIn(),t.onerror=function(e){console.log("ERROR: "+e),$(".preload-file").fadeOut()},t.onloadend=function(e){loadFile(e.target.result),$(".preload-file").fadeOut()},t.readAsText(e)})})}),document.body.addEventListener("dragover",function(e){e.preventDefault()}),document.body.addEventListener("drop",function(e){e.preventDefault();for(var t,a=e.dataTransfer,s=a.files,o=0;o<s.length;o++){var r=s[o];t=new FileReader,t.readAsText(r)}t.onload=function(e){loadFile(e.target.result)}}),$("#data").on("click",function(e){document.getElementById("data").value=""}),$(".preload").fadeOut(function(){$(".wrapper, .bar").fadeIn()})});