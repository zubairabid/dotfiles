!function(t){function e(t){return Math.max(0,Math.round(100*Math.pow(2,t/6))/100)}function a(t,e){var a,i,s=0,n=0,u=0,o=0;return a=t.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(a[2],10)-(a[1]+"").length,a=e.toExponential().match(/^.\.?(.*)e(.+)$/),n=parseInt(a[2],10)-(a[1]+"").length,n>s&&(s=n),i=t%e,s<-100||s>20?(u=Math.round(Math.log(i)/Math.log(10)),o=Math.pow(10,u),(i/o).toFixed(u-s)*o):parseFloat(i.toFixed(-s))}function i(t){return 0===t?1:Math.abs(t)/t}function s(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function n(t,e){return void 0===t?e:t}var u,o,r=function(e){t.AudioContext||(t.AudioContext=t.webkitAudioContext),e||(console.log("tuna.js: Missing audio context! Creating a new context for you."),e=t.AudioContext&&new t.AudioContext),u=e,o=this},l=function(t,e){t.value=e},h=Object.create(null,{activate:{writable:!0,value:function(t){t?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(t)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(t){this._lastBypassValue!==t&&(this._bypass=t,this.activate(!t),this._lastBypassValue=t)}},connect:{value:function(t){this.output.connect(t)}},disconnect:{value:function(t){this.output.disconnect(t)}},connectInOrder:{value:function(t){for(var e=t.length-1;e--;){if(!t[e].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",t[e]);t[e+1].input?t[e].connect(t[e+1].input):t[e].connect(t[e+1])}}},getDefaults:{value:function(){var t={};for(var e in this.defaults)t[e]=this.defaults[e].value;return t}},automate:{value:function(t,e,a,i){var s,n=i?~~(i/1e3):u.currentTime,o=a?~~(a/1e3):0,r=this.defaults[t],l=this[t];l?r.automatable?(a?(s="linearRampToValueAtTime",l.cancelScheduledValues(n),l.setValueAtTime(l.value,n)):s="setValueAtTime",l[s](e,o+n)):l=e:console.error("Invalid Property for "+this.name)}}}),c="float";r.prototype.Filter=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.filter=u.createBiquadFilter(),this.output=u.createGain(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=t.frequency||this.defaults.frequency.value,this.Q=t.resonance||this.defaults.Q.value,this.filterType=n(t.filterType,this.defaults.filterType.value),this.gain=n(t.gain,this.defaults.gain.value),this.bypass=t.bypass||!1},r.prototype.Filter.prototype=Object.create(h,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:c},Q:{value:1,min:.001,max:100,automatable:!0,type:c},gain:{value:0,min:-40,max:40,automatable:!0,type:c},bypass:{value:!0,automatable:!1,type:"boolean"},filterType:{value:"lowpass",automatable:!1,type:"string"}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(t){this.filter.type=t}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(t){this.filter.Q.setTargetAtTime(t,u.currentTime,.01)}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(t){this.filter.gain.setTargetAtTime(t,u.currentTime,.01)}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.setTargetAtTime(t,u.currentTime,.01)}}}),r.prototype.Bitcrusher=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=u.createGain(),this.activateNode=u.createGain(),this.processor=u.createScriptProcessor(this.bufferSize,1,1),this.output=u.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var e,a,i,s,o,r=0,l=0;this.processor.onaudioprocess=function(t){for(e=t.inputBuffer.getChannelData(0),a=t.outputBuffer.getChannelData(0),i=Math.pow(.5,this.bits),o=e.length,s=0;s<o;s++)r+=this.normfreq,r>=1&&(r-=1,l=i*Math.floor(e[s]/i+.5)),a[s]=l},this.bits=t.bits||this.defaults.bits.value,this.normfreq=n(t.normfreq,this.defaults.normfreq.value),this.bypass=t.bypass||!1},r.prototype.Bitcrusher.prototype=Object.create(h,{name:{value:"Bitcrusher"},defaults:{writable:!0,value:{bits:{value:4,min:1,max:16,automatable:!1,type:"int"},bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:"int"},bypass:{value:!1,automatable:!1,type:"boolean"},normfreq:{value:.1,min:1e-4,max:1,automatable:!1,type:c}}},bits:{enumerable:!0,get:function(){return this.processor.bits},set:function(t){this.processor.bits=t}},normfreq:{enumerable:!0,get:function(){return this.processor.normfreq},set:function(t){this.processor.normfreq=t}}}),r.prototype.Cabinet=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.convolver=this.newConvolver(t.impulsePath),this.makeupNode=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=n(t.makeupGain,this.defaults.makeupGain),this.bypass=t.bypass||!1},r.prototype.Cabinet.prototype=Object.create(h,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:c},bypass:{value:!1,automatable:!1,type:"boolean"}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=t}},newConvolver:{value:function(t){return new o.Convolver({impulse:t,dryLevel:0,wetLevel:1})}}}),r.prototype.Chorus=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.attenuator=this.activateNode=u.createGain(),this.splitter=u.createChannelSplitter(2),this.delayL=u.createDelay(),this.delayR=u.createDelay(),this.feedbackGainNodeLR=u.createGain(),this.feedbackGainNodeRL=u.createGain(),this.merger=u.createChannelMerger(2),this.output=u.createGain(),this.lfoL=new o.LFO({target:this.delayL.delayTime,callback:l}),this.lfoR=new o.LFO({target:this.delayR.delayTime,callback:l}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=n(t.feedback,this.defaults.feedback.value),this.rate=n(t.rate,this.defaults.rate.value),this.delay=n(t.delay,this.defaults.delay.value),this.depth=n(t.depth,this.defaults.depth.value),this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},r.prototype.Chorus.prototype=Object.create(h,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:c},delay:{value:.0045,min:0,max:1,automatable:!1,type:c},depth:{value:.7,min:0,max:1,automatable:!1,type:c},rate:{value:1.5,min:0,max:8,automatable:!1,type:c},bypass:{value:!0,automatable:!1,type:"boolean"}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(t){this._delay=2*Math.pow(10,t)*2e-4,this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),r.prototype.Compressor=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.compNode=this.activateNode=u.createDynamicsCompressor(),this.makeupNode=u.createGain(),this.output=u.createGain(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=n(t.automakeup,this.defaults.automakeup.value),this.makeupGain=t.makeupGain||this.defaults.makeupGain.value,this.threshold=n(t.threshold,this.defaults.threshold.value),this.release=t.release||this.defaults.release.value,this.attack=n(t.attack,this.defaults.attack.value),this.ratio=t.ratio||this.defaults.ratio.value,this.knee=n(t.knee,this.defaults.knee.value),this.bypass=t.bypass||!1},r.prototype.Compressor.prototype=Object.create(h,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:c},release:{value:250,min:10,max:2e3,automatable:!0,type:c},makeupGain:{value:1,min:1,max:100,automatable:!0,type:c},attack:{value:1,min:0,max:1e3,automatable:!0,type:c},ratio:{value:4,min:1,max:50,automatable:!0,type:c},knee:{value:5,min:0,max:40,automatable:!0,type:c},automakeup:{value:!1,automatable:!1,type:"boolean"},bypass:{value:!0,automatable:!1,type:"boolean"}}},computeMakeup:{value:function(){var t=this.compNode;return-(t.threshold.value-t.threshold.value/t.ratio.value)/4}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(t){this._automakeup=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(t){this.compNode.threshold.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(t){this.compNode.ratio.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(t){this.compNode.knee.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(t){this.compNode.attack.value=t/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(t){this.compNode.release=t/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.setTargetAtTime(e(t),u.currentTime,.01)}}}),r.prototype.Convolver=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.convolver=u.createConvolver(),this.dry=u.createGain(),this.filterLow=u.createBiquadFilter(),this.filterHigh=u.createBiquadFilter(),this.wet=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=n(t.dryLevel,this.defaults.dryLevel.value),this.wetLevel=n(t.wetLevel,this.defaults.wetLevel.value),this.highCut=t.highCut||this.defaults.highCut.value,this.buffer=t.impulse,this.lowCut=t.lowCut||this.defaults.lowCut.value,this.level=n(t.level,this.defaults.level.value),this.filterHigh.type="lowpass",this.filterLow.type="highpass",this.bypass=t.bypass||!1},r.prototype.Convolver.prototype=Object.create(h,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:c},lowCut:{value:20,min:20,max:22050,automatable:!0,type:c},dryLevel:{value:1,min:0,max:1,automatable:!0,type:c},wetLevel:{value:1,min:0,max:1,automatable:!0,type:c},level:{value:1,min:0,max:1,automatable:!0,type:c}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(t){this.filterLow.frequency.setTargetAtTime(t,u.currentTime,.01)}},highCut:{get:function(){return this.filterHigh.frequency},set:function(t){this.filterHigh.frequency.setTargetAtTime(t,u.currentTime,.01)}},level:{get:function(){return this.output.gain},set:function(t){this.output.gain.setTargetAtTime(t,u.currentTime,.01)}},dryLevel:{get:function(){return this.dry.gain},set:function(t){this.dry.gain.setTargetAtTime(t,u.currentTime,.01)}},wetLevel:{get:function(){return this.wet.gain},set:function(t){this.wet.gain.setTargetAtTime(t,u.currentTime,.01)}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(t){var e=this.convolver,a=new XMLHttpRequest;t&&(a.open("GET",t,!0),a.responseType="arraybuffer",$(".preload-impulse").fadeIn(),$("#impulses-button .ui-icon-triangle-1-s").css("display","none"),a.onreadystatechange=function(){4===a.readyState&&(a.status<300&&a.status>199||302===a.status)&&u.decodeAudioData(a.response,function(t){e.buffer=t,$(".preload-impulse").fadeOut(),$("#impulses-button .ui-icon-triangle-1-s").css("display","block")},function(t){t&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+t)})},a.send(null))}}}),r.prototype.Delay=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.dry=u.createGain(),this.wet=u.createGain(),this.filter=u.createBiquadFilter(),this.delay=u.createDelay(),this.feedbackNode=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=t.delayTime||this.defaults.delayTime.value,this.feedback=n(t.feedback,this.defaults.feedback.value),this.wetLevel=n(t.wetLevel,this.defaults.wetLevel.value),this.dryLevel=n(t.dryLevel,this.defaults.dryLevel.value),this.cutoff=t.cutoff||this.defaults.cutoff.value,this.filter.type="lowpass",this.bypass=t.bypass||!1},r.prototype.Delay.prototype=Object.create(h,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:c},feedback:{value:.45,min:0,max:.9,automatable:!0,type:c},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:c},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:c},dryLevel:{value:1,min:0,max:1,automatable:!0,type:c}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(t){this.delay.delayTime.value=t/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(t){this.feedbackNode.gain.value=t}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),r.prototype.MoogFilter=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=u.createGain(),this.activateNode=u.createGain(),this.processor=u.createScriptProcessor(this.bufferSize,1,1),this.output=u.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var e,a,i,s,o,r,l,h;e=a=i=s=o=r=l=h=0;var c,f,p,m,v,d;this.processor.onaudioprocess=function(t){for(c=t.inputBuffer.getChannelData(0),f=t.outputBuffer.getChannelData(0),p=1.16*this.cutoff,inputFactor=p*p*.35013*(p*p),m=this.resonance*(1-.15*p*p),d=c.length,v=0;v<d;v++)c[v]-=h*m,c[v]*=inputFactor,o=c[v]+.3*e+(1-p)*o,e=c[v],r=o+.3*a+(1-p)*r,a=o,l=r+.3*i+(1-p)*l,i=r,h=l+.3*s+(1-p)*h,s=l,f[v]=h},this.cutoff=n(t.cutoff,this.defaults.cutoff.value),this.resonance=n(t.resonance,this.defaults.resonance.value),this.bypass=t.bypass||!1},r.prototype.MoogFilter.prototype=Object.create(h,{name:{value:"MoogFilter"},defaults:{writable:!0,value:{bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:"int"},bypass:{value:!1,automatable:!1,type:"boolean"},cutoff:{value:.065,min:1e-4,max:1,automatable:!1,type:c},resonance:{value:3.5,min:0,max:4,automatable:!1,type:c}}},cutoff:{enumerable:!0,get:function(){return this.processor.cutoff},set:function(t){this.processor.cutoff=t}},resonance:{enumerable:!0,get:function(){return this.processor.resonance},set:function(t){this.processor.resonance=t}}}),r.prototype.Overdrive=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.inputDrive=u.createGain(),this.waveshaper=u.createWaveShaper(),this.outputDrive=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=n(t.drive,this.defaults.drive.value),this.outputGain=n(t.outputGain,this.defaults.outputGain.value),this.curveAmount=n(t.curveAmount,this.defaults.curveAmount.value),this.algorithmIndex=n(t.algorithmIndex,this.defaults.algorithmIndex.value),this.bypass=t.bypass||!1},r.prototype.Overdrive.prototype=Object.create(h,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:c,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:c,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:c},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:"int"}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(t){this._drive=t}},curveAmount:{get:function(){return this._curveAmount},set:function(t){this._curveAmount=t,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(t){this._outputGain=e(t)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(t){this._algorithmIndex=t,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(t,e,a){t=Math.min(t,.9999);var i,s,n=2*t/(1-t);for(i=0;i<e;i++)s=2*i/e-1,a[i]=(1+n)*s/(1+n*Math.abs(s))},function(t,e,a){var i,n,u;for(i=0;i<e;i++)n=2*i/e-1,u=(.5*Math.pow(n+1.4,2)-1)*u>=0?5.8:1.2,a[i]=s(u)},function(t,e,a){var i,n,u,o=1-t;for(i=0;i<e;i++)n=2*i/e-1,u=n<0?-Math.pow(Math.abs(n),o+.04):Math.pow(n,o),a[i]=s(2*u)},function(t,e,a){var s,n,u,o,r=1-t>.99?.99:1-t;for(s=0;s<e;s++)n=2*s/e-1,o=Math.abs(n),o<r?u=o:o>r?u=r+(o-r)/(1+Math.pow((o-r)/(1-r),2)):o>1&&(u=o),a[s]=i(n)*u*(1/((r+1)/2))},function(t,e,a){var i,s;for(i=0;i<e;i++)s=2*i/e-1,a[i]=s<-.08905?-.75*(1-Math.pow(1-(Math.abs(s)-.032857),12)+1/3*(Math.abs(s)-.032847))+.01:s>=-.08905&&s<.320018?s*s*-6.153+3.9375*s:.630035},function(t,e,a){var i,s,n=2+Math.round(14*t),u=Math.round(Math.pow(2,n-1));for(i=0;i<e;i++)s=2*i/e-1,a[i]=Math.round(s*u)/u}]}}),r.prototype.Phaser=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.splitter=this.activateNode=u.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=u.createGain(),this.feedbackGainNodeR=u.createGain(),this.merger=u.createChannelMerger(2),this.filteredSignal=u.createGain(),this.output=u.createGain(),this.lfoL=new o.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new o.LFO({target:this.filtersR,callback:this.callback});for(var e=this.stage;e--;)this.filtersL[e]=u.createBiquadFilter(),this.filtersR[e]=u.createBiquadFilter(),this.filtersL[e].type="allpass",this.filtersR[e].type="allpass";this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=n(t.rate,this.defaults.rate.value),this.baseModulationFrequency=t.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=n(t.depth,this.defaults.depth.value),this.feedback=n(t.feedback,this.defaults.feedback.value),this.stereoPhase=n(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},r.prototype.Phaser.prototype=Object.create(h,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:c},depth:{value:.6,min:0,max:1,automatable:!1,type:c},feedback:{value:.7,min:0,max:1,automatable:!1,type:c},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:c},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:c}}},callback:{value:function(t,e){for(var a=0;a<4;a++)t[a].frequency.value=e}},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(t){this._baseModulationFrequency=t,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=a(e,2*Math.PI),this.lfoR._phase=e}}}),r.prototype.Tremolo=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.splitter=this.activateNode=u.createChannelSplitter(2),this.amplitudeL=u.createGain(),this.amplitudeR=u.createGain(),this.merger=u.createChannelMerger(2),this.output=u.createGain(),this.lfoL=new o.LFO({target:this.amplitudeL.gain,callback:l}),this.lfoR=new o.LFO({target:this.amplitudeR.gain,callback:l}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=t.rate||this.defaults.rate.value,this.intensity=n(t.intensity,this.defaults.intensity.value),this.stereoPhase=n(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},r.prototype.Tremolo.prototype=Object.create(h,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:c},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:c},rate:{value:5,min:.1,max:11,automatable:!1,type:c}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(t){this._intensity=t,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._rate},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=a(e,2*Math.PI),this.lfoR.phase=e}}}),r.prototype.WahWah=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.envelopeFollower=new o.EnvelopeFollower({target:this,callback:function(t,e){t.sweep=e}}),this.filterBp=u.createBiquadFilter(),this.filterPeaking=u.createBiquadFilter(),this.output=u.createGain(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=n(t.enableAutoMode,this.defaults.automode.value),this.resonance=t.resonance||this.defaults.resonance.value,this.sensitivity=n(t.sensitivity,this.defaults.sensitivity.value),this.baseFrequency=n(t.baseFrequency,this.defaults.baseFrequency.value),this.excursionOctaves=t.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=n(t.sweep,this.defaults.sweep.value),this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=t.bypass||!1},r.prototype.WahWah.prototype=Object.create(h,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:"boolean"},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:c},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:c},sweep:{value:.2,min:0,max:1,automatable:!1,type:c},resonance:{value:10,min:1,max:100,automatable:!1,type:c},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:c}}},activateCallback:{value:function(t){this.automode=t}},automode:{get:function(){return this._automode},set:function(t){this._automode=t,t?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},filterFreqTimeout:{value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}catch(t){clearTimeout(this.filterFreqTimeout),this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(t){this._sweep=Math.pow(t>1?1:t<0?0:t,this._sensitivity),this.setFilterFreq()}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=50*Math.pow(10,2*t),this._excursionFrequency=Math.min(u.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(t){this._excursionOctaves=t,this._excursionFrequency=Math.min(u.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(t){this._sensitivity=Math.pow(10,t)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(t){this._resonance=t,this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type="peaking",this.filterBp.type="bandpass",this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1}}}),r.prototype.EnvelopeFollower=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.jsNode=this.output=u.createScriptProcessor(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=n(t.attackTime,this.defaults.attackTime.value),this.releaseTime=n(t.releaseTime,this.defaults.releaseTime.value),this._envelope=0,this.target=t.target||{},this.callback=t.callback||function(){}},r.prototype.EnvelopeFollower.prototype=Object.create(h,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:c},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:c}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(t){this._attackTime=t,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(t){this._releaseTime=t,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(t){"function"==typeof t?this._callback=t:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){this.activated=t,t?(this.jsNode.connect(u.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(t){return function(e){t.compute(e)}}},compute:{value:function(t){var e,a,i,s,n=t.inputBuffer.getChannelData(0).length,u=t.inputBuffer.numberOfChannels;if(a=i=s=0,u>1)for(s=0;s<n;++s)for(;a<u;++a)e=t.inputBuffer.getChannelData(a)[s],i+=e*e/u;else for(s=0;s<n;++s)e=t.inputBuffer.getChannelData(0)[s],i+=e*e;i=Math.sqrt(i),this._envelope<i?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*i):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*i),this._callback(this._target,this._envelope)}}}),r.prototype.LFO=function(t){this.output=u.createScriptProcessor(256,1,1),this.activateNode=u.destination,this.frequency=n(t.frequency,this.defaults.frequency.value),this.offset=n(t.offset,this.defaults.offset.value),this.oscillation=n(t.oscillation,this.defaults.oscillation.value),this.phase=n(t.phase,this.defaults.phase.value),this.target=t.target||{},this.output.onaudioprocess=this.callback(t.callback||function(){}),this.bypass=t.bypass||!1},r.prototype.LFO.prototype=Object.create(h,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:c},offset:{value:.85,min:0,max:22049,automatable:!1,type:c},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:c},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:c}}},frequency:{get:function(){return this._frequency},set:function(t){this._frequency=t,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(t){this._offset=t}},oscillation:{get:function(){return this._oscillation},set:function(t){this._oscillation=t}},phase:{get:function(){return this._phase},set:function(t){this._phase=t}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){t?this.output.connect(u.destination):this.output.disconnect(u.destination)}},callback:{value:function(t){var e=this;return function(){e._phase+=e._phaseInc,e._phase>2*Math.PI&&(e._phase=0),t(e._target,e._offset+e._oscillation*Math.sin(e._phase))}}}}),r.toString=r.prototype.toString=function(){return"You are running Tuna version 0.2 by Dinahmoe!"},"function"==typeof define?define("Tuna",[],function(){return r}):t.Tuna=r}(this);