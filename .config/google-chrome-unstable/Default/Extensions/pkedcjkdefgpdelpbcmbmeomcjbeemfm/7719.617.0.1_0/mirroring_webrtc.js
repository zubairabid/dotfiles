'use strict';var gsa={TAB:0,Bk:1,yo:2},Y$=function(a){Cb("MediaRouter.WebRtc.Start.Success",a,gsa)};var Z$=function(a,c){qj.call(this,c);this.C=a;this.g=new Db;this.b=Iw(c.id);this.w=new Db;this.D=!1;this.l=null;this.s=!1;this.o=this.h=null;hsa(this);isa(this);this.b.sendMessage(new wj("GET_TURN_CREDENTIALS"))};q(Z$,qj);
Z$.prototype.start=function(a){var c=this;return this.g.b.then(function(b){if(b.b)return Promise.reject(new ui("Mirroring already started"));if(c.l)return Promise.reject(new ui("Session permanently stopped"));c.h=new sb("MediaRouter.WebRtc.Session.Launch");b.ja.addStream(a);b.start();return c.w.b})};
Z$.prototype.stop=function(){var a=this;this.w.reject(new ui("Session stop requested."));this.o&&(this.o.end(),this.o=null);if(this.l)return this.l;this.s=this.D=!1;this.h=null;return this.l=this.g.b.then(function(c){c.stop()}).then(function(){return a.b.ab()}).catch(function(c){a.b.ab();throw c;})};
var hsa=function(a){a.b.onMessage=function(c){if(!c.type)throw Error("Message has no type.");switch(c.type){case "TURN_CREDENTIALS":a.g.resolve(new Bj(a.f.id,c.data.credentials));break;case "ANSWER":a.g.b.then(function(b){Jj(b,c.data)});break;case "KNOCK_ANSWER":a.s=!0;a.g.b.then(function(b){Jj(b,c.data)});break;case "STOP":a.w.reject(new ui("Stop signal received"));a.stop();break;default:throw new ui("Unknown message type: "+c.type);}}},isa=function(a){a.g.b.then(function(c){Fj(c,function(b){a.b.sendMessage(new wj("OFFER",
new yj(b,a.C,zj)))});Gj(c,function(b){b=xj(b);a.b.sendMessage(b)});Cj(c,function(){a.D=!0;a.b.sendMessage(new wj("SESSION_START_SUCCESS"));!a.s&&a.h&&a.h.end();a.h=null;a.o=new yb("MediaRouter.WebRtc.Session.Length");a.w.resolve(a)});Ej(c,function(){a.b.sendMessage(new wj("SESSION_END"))});Dj(c,function(b){a.D||a.w.reject(b);a.b.sendMessage(new wj("SESSION_FAILURE"))})})};var $$=function(){fj.call(this,"webrtc")};q($$,fj);h=$$.prototype;h.xh=function(a,c){return new Z$(a,c)};h.eh=function(){Y$(0)};h.Zg=function(){Y$(1)};h.Xh=function(){Y$(2)};h.ah=function(){Bb("MediaRouter.WebRtc.Session.End")};h.bh=function(a){Cb("MediaRouter.WebRtc.Start.Failure",a,ti)};h.dh=function(){Bb("MediaRouter.WebRtc.Stream.End")};var jsa=new $$;Wi("mr.mirror.webrtc.WebRtcService",jsa);
