{"version":3,"sources":["about.js"],"names":["T","ui_lib","RMT","be_ext","be_premium","REPORT_HASH","Report_problem","state","valid_email","on_hash_change","old_modal","modal","window","location","hash","setState","be_lib","perr_err","id","info","perr","rate_limit","count","hide_modal","verify_email","email","zurl","is_valid_email","send_report","subj","desc","url","be_bg_main","bg_log","get_log","get","e","bg_log_err","perr_ok","addEventListener","qs","qs_parse","search","replace","removeEventListener","key","ev","target","value","on_change","bind","render_modal","React","Component","About_details","props","on_title_click","now","Date","dev_mode_first_ts","dev_mode_counter","mode","be_dev_mode","fcall","send_email","model_to_state","lines","mailto_val","be_util","problem_mailto_url","s","val","push","trim","map","line","display","dev_mode","PureComponent","About_layout","user_info","user","is_plus","uninit","B","backbone","client","stop","init","context","start","ReactDOM","render","document","querySelector"],"mappings":"eAAA;AACA,A,kBAAc,+tFAad;;;;;;;;;;;;;YAAM,IAAI,iBAAV,AAAiB,AACjB;YAAI,WAAJ,EAAS,cAAT,EAAiB,kBAAjB,AAEA;;YAAM,cAAN,AAAoB,gB,AACd;A;A,qBACF,GAAQ,EAAC,aAAD,AAAc,A;A,8BACtB,GAAiB,YAAI,AACjB;wBAAI,YAAY,CAAC,CAAC,MAAA,AAAK,MAAvB,AAA6B,AAC7B;wBAAI,QAAQ,OAAA,AAAO,SAAP,AAAgB,QAA5B,AAAkC,AAClC;0BAAA,AAAK,SAAS,EAAC,OAAf,AAAc,AACd;wBAAI,aAAA,AAAW,SAAf,AAAwB,AACxB;AACI;sCAAA,AAAO,SAAS,EAAC,IAAD,AAAK,qBAAqB,MAAM,EAAC,MAAjC,AAAgC,AAAO,AACnD;wCAAY,EAAC,OADjB,AAAgB,AACA,AAAQ,AAC3B;AACJ;A,mBAUD;;;;;;;;;;A,6BAAa,YAAI,AACb;2BAAA,AAAO,SAAP,AAAgB,OAAhB,AAAuB,AAC1B;A,mBACD;A,+BAAe,YAAI,KACI;0BADJ,AACS,MADT,AACV,MADU,AACV,0CADU,AACF,KACb;0BAAA,AAAK,SAAS,EAAC,aAAa,cAAA,AAAK,eAAjC,AAAc,AAAc,AAAoB,AACnD;A,mBAID;;;;A,8BAAc,YAAI,KACiB;0BADjB,AACsB,MADtB,AACT,oBADS,AACT,MADS,AACF,mBADE,AACF,KADE,AACI,mBADJ,AACI,KADJ,AACU,kBADV,AACU,AACxB;wBAAI,OAAO,EAAC,OAAD,OAAQ,MAAR,MAAc,MAAd,MAAoB,KAA/B,AAAW,AACX;wBAAI,kBAAJ,AACA;wBAAI,aAAa,OAAjB,AAAwB,AACxB;AACI;4BAAI,CAAE,KAAA,AAAK,SAAS,WAAA,AAAW,QAAQ,OAAA,AAAO,IAAxC,AAAc,AAAmB,AAAW,AAAiB,eACnE;+BAAA,AAAM,GAAE,CAAE,KAAA,AAAK,aAAL,AAAkB,AAAI,EACnC;AACD;kCAAA,AAAO,QAAQ,EAAC,IAAD,AAAK,mBAAmB,MAAvC,AAAe,AACf;0BAAA,AAAK,AACL;0BAAA,AAAK,SAAS,EAAC,OAAD,AAAQ,IAAI,MAAZ,AAAkB,IAAI,MAAtB,AAA4B,IAAI,KAA9C,AAAc,AAAqC,AACtD;A,kKA/BkB,CACf,OAAA,AAAO,iBAAP,AAAwB,cAAc,KAAtC,AAA2C,gBAA3C,AAA2D,OAC3D,KAAA,AAAK,iBACL,IAAI,KAAK,cAAA,AAAK,SAAS,OAAA,AAAO,SAAP,AAAgB,OAAhB,AAAuB,QAAvB,AAA+B,OAAtD,AAAS,AAAc,AAAsC,KAC7D,KAAA,AAAK,SAAS,EAAC,KAAK,GAAN,AAAS,KAAK,MAAM,GAAlC,AAAc,AAAuB,AACxC,Q,2EACqB,CAClB,OAAA,AAAO,oBAAP,AAA2B,cAAc,KAAzC,AAA8C,AACjD,gB,mDAQS,A,KAAK,A,IAAG,CACd,KAAA,AAAK,6BAAL,AAAgB,KAAM,GAAA,AAAG,OAAzB,AAAgC,AACnC,Q,4CAca;qBACuB;yBADvB,AAC4B,MAD5B,AACL,qBADK,AACL,YADK,AACQ,eADR,AACQ,MADR,AACe,cADf,AACe,AACzB;wBAAI,cAAc,qCAAG,WAAH,AAAa,AAC3B;iCAAS,KADK,AACA,eAAa,8BAAA,AAAC,SADhC,AAAkB,AAElB;2BAAO,8BAAC,UAAD,SAAO,OAAO,EAAd,AAAc,AAAE,qBAAqB,UAAU,KAA/C,AAAoD,AACzD;gCADK,AACG,AACR;2DAAK,qCAAW,AAAW,AACvB;0BAAC,aAAa,CADlB,AAAgB,AACZ,AAAe,AACjB,aAFc;6DAEP,MAAP,AAAY,QAAO,aAAnB,AAA+B,AAC7B;mCADF,AACY,gBAAe,QAAQ,KADnC,AACwC,AACtC;+BAFF,AAES,OAAO,UAAU,KAAA,AAAK,UAAL,AAAe,KAAf,AAAoB,MAJhD,AAEE,AAE0B,AAA0B,AACnD;qBAAA,AAAC,AACA;4DAAM,WAAN,AAAgB,gBARf,AAEL,AAQA;;2DAAK,WAAL,AAAe,AACb;6DAAO,MAAP,AAAY,QAAO,aAAnB,AAA+B,WAAU,WAAzC,AAAmD,AACjD;+BADF,AACS,MAAM,UAAU,KAAA,AAAK,UAAL,AAAe,KAAf,AAAoB,MAZ1C,AAUL,AACE,AACyB,AAA0B,AAErD;;2DAAK,WAAL,AAAe,AACb;gEAAU,aAAV,AAAsB,eAAc,MAApC,AAAyC,AACvC;mCADF,AACY,AACV;kCAAU,KAAA,AAAK,UAAL,AAAe,KAAf,AAAoB,MAjBpC,AAAO,AAcL,AACE,AAEY,AAA0B,AAG7C;;;A,sDACO;AACJ;2BAAO,uCAAK,WAAL,AAAe,AACpB;yDAAG,WAAH,AAAa,SAAQ,MAArB,AAA0B,AACxB;kDAAA,AAAC,SAFE,AACL,AAGC;;yBAAA,AAAK,MAAL,AAAW,SAAS,KAJvB,AAAO,AAIgB,AAAK,AAE/B;;A,8CA5EwB,gBAAM,A;;;A,4EAiF/B;;mCAAA,AAAY,OAAM,2JACR;AADQ,+BADlB,AACkB,QADV,AACU;;;;;;;AAAA,iCAQD,YAAI,AACjB;wBAAI,MAAM,KAAV,AAAU,AAAK,AACf;wBAAI,CAAC,OAAD,AAAM,qBAAqB,MAAI,OAAJ,AAAS,oBAAxC,AAA0D,AAC1D;AACI;+BAAA,AAAK,oBAAL,AAAyB,AACzB;+BAAA,AAAK,mBAAL,AAAwB,AAC3B;AACD;2BAAA,AAAK,AACL;wBAAI,OAAA,AAAK,oBAAT,AAA2B,AACvB;AACJ;2BAAA,AAAK,mBAAL,AAAwB,AACxB;2BAAA,AAAK,oBAAL,AAAyB,AACzB;wBAAI,OAAO,CAAC,IAAA,AAAI,YAAJ,AAAgB,IAA5B,AAAY,AAAoB,AAChC;wBAAA,AAAI,YAAJ,AAAgB,MAAhB,AAAsB,UAAU,CAAhC,AAAgC,AAAC,AACpC;AAtBiB,iBAQlB;AARkB,6BAuBL,aAAG,AACZ;kCAAA,AAAO,WAAU,IAAD,AAAK,AACjB;8BAAM,EAAC,OADK,AACN,AAAQ,GADF,EACM,YAAY,EAAC,OADnC,AAAgB,AACkB,AAAQ,AAC1C;AACH;AA3BiB,iBAuBlB,CArBI,OAAA,AAAK,mBAAL,AAAwB,EACxB,OAAA,AAAK,oBAAL,AAAyB,EAHX,OAIjB,qGACkB,CACf,KAAA,AAAK,eAAe,IAApB,AAAwB,aAAxB,AAAqC,AACxC,Y,sCAqBO;AACJ;wBAAI,QAAJ,AAAY,AACZ;wBAAI,aAAa,eAAA,AAAQ,mBAAmB,UAAA,AAAC,GAAD,AAAI;kCAC5C,AAAM,KAAK,EAAC,KAAK,EAAN,AAAM,AAAE,QAAQ,OADa,AACxC,AAAW,AAAuB,MAAlC,EADJ,AAAiB,AAEjB;2BAAO,8BAAC,UAAD,WAAS,OAAO,EAAhB,AAAgB,AAAE,eAAe,UAAU,KAA3C,AAAgD,AACpD;0BAAA,AAAM,IAAI,sDAAO,UAAD,cAAY,KAAK,KAAjB,AAAsB,KAAK,OAAO,EAAE,KAApC,AAAkC,AAAO,AACrD;6BADM,AAAM,AACP,KADO,EADZ,AACJ,AAGD;;kDAAC,UAAD,kBACgB;yDAAG,MAAH,AAAS,AACrB;iCAAS,KADG,AACE,YAAY,QADd,AACqB,yBAFrC,AAKE;;;8DAAQ,IAAR,AAAW,uBAAsB,OAAO,EAAC,SATtC,AAIL,AAKE,AAAwC,AAAU,AAEnD;;yBAAA,AAAK,MAAL,AAAW,YAAY,8BAAC,UAAD,kBAX1B,AAAO,AAaV;;A,oB,yBA/CuB,U,cAAtB;;;A,kWAmDiB;AACf;yBAAA,AAAK,eAAL,AAAoB,YAApB,AAAgC,AAChC;yBAAA,AAAK,eAAL,AAAoB,QAApB,AAA4B,cAA5B,AAA0C,AAC7C;A,sDACO;iBACC;AADD,4BAAA,AACU,KADV,AACC,AACL;wBAAI,YAAY,EAAC,MAAM,MAAP,AAAa,MAAM,SAAS,MAA5C,AAAgB,AAAkC,AAClD;AACI;sDAAC,UAAD,0BAAA,AAAiB,aAAW,OAAO,EAAnC,AAAmC,AAAE,UAAU,KAA/C,AAAmD,AACjD;sDAAA,AAAC,gBADH,AAEE;sDAAA,AAAC,eAFH,AAGE;sDAAC,UAAD,eAJN,AACI,AAMP;;;A,4CAfsB,U,AAkB3B,cAlBM;;;YAkBA,SAAS,SAAT,AAAS,SAAI,AACf;8BAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,KAAlB,AAAuB,AACvB;8BAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,KAAlB,AAAuB,AACvB;8BAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,KAAlB,AAAuB,AACvB;8BAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,KAAlB,AAAuB,AAC1B;AALD,AAOO;;YAAM,sBAAO,SAAP,AAAO,OAAI,AACpB;mBAAA,AAAO,iBAAP,AAAwB,UAAxB,AAAkC,AAClC;8BAAA,AAAE,KAAK,EAAC,SAAR,AAAO,AAAU,AACjB;mBAAA,AAAO,aAAa,kBAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,MAAtC,AAAoB,AAAwB,AAC5C;kBAAM,kBAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,MAAxB,AAAM,AAAwB,AAC9B;qBAAS,kBAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,MAA3B,AAAS,AAAwB,AACjC;yBAAa,kBAAA,AAAE,SAAF,AAAW,OAAX,AAAkB,MAA/B,AAAa,AAAwB,AACrC;+BAAA,AAAS,OAAO,8BAAA,AAAC,cAAjB,OAAiC,SAAA,AAAS,cAA1C,AAAiC,AAAuB,AAC3D;AARM,A,W","file":"about.js","sourcesContent":["                   \n'use strict';                                              \nimport 'regenerator-runtime';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport {Page_layout, Section, Label_line, PureComponent, Modal, Legal_section}\n    from '/bext/vpn/pub/page_lib.js';\nimport classnames from 'classnames';\nimport ui_lib from '/bext/vpn/pub/ui_lib.js';\nimport be_util from '/bext/pub/util.js';\nimport B from '/bext/pub/browser.js';\nimport zurl from '/util/url.js';\nimport be_lib from '/bext/pub/lib.js';\n\nconst T = ui_lib.T;\nlet RMT, be_ext, be_premium;\n\nconst REPORT_HASH = '#report_issue';\nclass Report_problem extends React.Component {\n    state = {valid_email: true};\n    on_hash_change = ()=>{\n        let old_modal = !!this.state.modal;\n        let modal = window.location.hash==REPORT_HASH;\n        this.setState({modal});\n        if (old_modal!=modal && modal)\n        {\n            be_lib.perr_err({id: 'be_report_problem', info: {perr: 1},\n                rate_limit: {count: 1}});\n        }\n    };\n    componentDidMount(){\n        window.addEventListener('hashchange', this.on_hash_change, false);\n        this.on_hash_change();\n        let qs = zurl.qs_parse(window.location.search.replace(/^\\?/, ''));\n        this.setState({url: qs.url, subj: qs.subj});\n    }\n    componentWillUnmount(){\n        window.removeEventListener('hashchange', this.on_hash_change);\n    }\n    hide_modal = ()=>{\n        window.location.hash = '';\n    };\n    verify_email = ()=>{\n        let {email = ''} = this.state;\n        this.setState({valid_email: zurl.is_valid_email(email)});\n    };\n    on_change(key, ev){\n        this.setState({[key]: ev.target.value});\n    }\n    send_report = ()=>{\n        let {email, subj, desc, url} = this.state;\n        let info = {email, subj, desc, url};\n        let be_bg_main;\n        if (be_bg_main = window.be_bg_main)\n        {\n            try { info.bg_log = be_bg_main.get_log(be_ext.get('is_premium')); }\n            catch(e){ info.bg_log_err = e; }\n        }\n        be_lib.perr_ok({id: 'be_issue_report', info});\n        this.hide_modal();\n        this.setState({email: '', subj: '', desc: '', url: ''});\n    };\n    render_modal(){\n        let {valid_email, email, subj} = this.state;\n        let send_report = <a className='send-report-btn'\n            onClick={this.send_report}><T>Send</T></a>;\n        return <Modal title={T('Report a problem')} on_close={this.hide_modal}\n          action={send_report}>\n          <div className={classnames('form-group',\n              {'has-error': !valid_email})}>\n            <input type='text' placeholder='Your e-mail'\n              className='form-control' onBlur={this.verify_email}\n              value={email} onChange={this.on_change.bind(this, 'email')}/>\n            {!valid_email &&\n              <span className='help-block'>Please enter a valid email.</span>}\n          </div>\n          <div className='form-group'>\n            <input type='text' placeholder='Subject' className='form-control'\n              value={subj} onChange={this.on_change.bind(this, 'subj')}/>\n          </div>\n          <div className='form-group'>\n            <textarea placeholder='Description' rows='10'\n              className='form-control'\n              onChange={this.on_change.bind(this, 'desc')}/>\n          </div>\n        </Modal>;\n    }\n    render(){\n        return <div className='section report-problem'>\n          <a className='title' href='#report_issue'>\n            <T>Report a problem</T>\n          </a>\n          {this.state.modal && this.render_modal()}\n        </div>;\n    }\n}\n\nclass About_details extends PureComponent {\n    state = {};\n    constructor(props){\n        super(props);\n        this.dev_mode_counter = 0;\n        this.dev_mode_first_ts = 0;\n    }\n    componentDidMount(){\n        this.model_to_state(RMT.be_dev_mode, 'dev_mode');\n    }\n    on_title_click = ()=>{\n        let now = Date.now();\n        if (!this.dev_mode_first_ts || now-this.dev_mode_first_ts>5000)\n        {\n            this.dev_mode_first_ts = now;\n            this.dev_mode_counter = 0;\n        }\n        this.dev_mode_counter++;\n        if (this.dev_mode_counter!=5)\n            return;\n        this.dev_mode_counter = 0;\n        this.dev_mode_first_ts = 0;\n        let mode = !RMT.be_dev_mode.get('dev_mode');\n        RMT.be_dev_mode.fcall('enable', [mode]);\n    };\n    send_email = e=>{\n        be_lib.perr_err({id: 'be_report_problem',\n            info: {email: 1}, rate_limit: {count: 1}});\n        return;\n    };\n    render(){\n        let lines = [];\n        let mailto_val = be_util.problem_mailto_url((s, val)=>\n            lines.push({key: s.trim(), value: val}));\n        return <Section title={T('About Hola')} on_click={this.on_title_click}>\n          {lines.map(line=><Label_line key={line.key} label={T(line.key)}>\n              {line.value}\n            </Label_line>)}\n          <Label_line>\n            Send email to <a href={mailto_val}\n              onClick={this.send_email} target='report_mailto_frame'>\n              help_be@hola.org\n            </a>\n            <iframe id='report_mailto_frame' style={{display: 'none'}}/>\n          </Label_line>\n          {this.state.dev_mode && <Label_line>Dev mode</Label_line>}\n        </Section>;\n    }\n}\n\nclass About_layout extends PureComponent {\n    componentDidMount(){\n        this.model_to_state(be_premium, 'user');\n        this.model_to_state(be_ext, 'is_premium', 'is_plus');\n    }\n    render(){\n        let {state} = this;\n        let user_info = {user: state.user, is_plus: state.is_plus};\n        return (\n            <Page_layout {...user_info} title={T('About')} cls='about'>\n              <Report_problem/>\n              <About_details/>\n              <Legal_section/>\n            </Page_layout>\n        );\n    }\n}\n\nconst uninit = ()=>{\n    B.backbone.client.stop('be_bg_main');\n    B.backbone.client.stop('RMT');\n    B.backbone.client.stop('be_ext');\n    B.backbone.client.stop('be_premium');\n};\n\nexport const init = ()=>{\n    window.addEventListener('unload', uninit);\n    B.init({context: null});\n    window.be_bg_main = B.backbone.client.start('be_bg_main');\n    RMT = B.backbone.client.start('RMT');\n    be_ext = B.backbone.client.start('be_ext');\n    be_premium = B.backbone.client.start('be_premium');\n    ReactDOM.render(<About_layout/>, document.querySelector('.react-root'));\n};\n"]}